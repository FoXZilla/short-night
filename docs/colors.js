!function(t){var e={};function n(s){if(e[s])return e[s].exports;var i=e[s]={i:s,l:!1,exports:{}};return t[s].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,s){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(s,i,function(e){return t[e]}.bind(null,i));return s},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=30)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=n(39);var i;e.DEBUG=!0,function(t){t.Timeline="time_line",t.Axis="axis",t.AxisBody="axis_body",t.AxisScale="axis_scale",t.AxisMilestone="axis_milestone",t.Event="event",t.EventBody="event_body",t.EventMark="event_mark",t.EventAxis="event_axis"}(i=e.SN||(e.SN={})),e.DATE_COUNT_EXTRA={day:432e5,week:3024e5,month:1296e6,quarter:3888e6,year:15552e6},e.WALK_ON={[i.EventAxis]:{offsetOneStep:15}},e.SN_VERSION=s.version},function(t,e,n){"use strict";var s=this&&this.__awaiter||function(t,e,n,s){return new(n||(n=Promise))(function(i,o){function r(t){try{h(s.next(t))}catch(t){o(t)}}function a(t){try{h(s.throw(t))}catch(t){o(t)}}function h(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(r,a)}h((s=s.apply(t,e||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0});const i=n(0);function o(t){return"object"==typeof t&&"number"==typeof t.x&&"number"==typeof t.y&&"number"==typeof t.width&&"number"==typeof t.height}function r(t){return[{startX:t.x,startY:t.y,endX:t.x+t.width,endY:t.y},{startX:t.x+t.width,startY:t.y,endX:t.x+t.width,endY:t.y+t.height},{startX:t.x+t.width,startY:t.y+t.height,endX:t.x,endY:t.y+t.height},{startX:t.x,startY:t.y+t.height,endX:t.x,endY:t.y}]}function a(t,e){let{startX:n,startY:s,endX:i,endY:o}=t,{startX:r,startY:a,endX:h,endY:l}=e;if([n,i,r,h,s,o,a,l].some(isNaN))throw TypeError("Unexpected NaN");[n,i,r,h,s,o,a,l]=[n,i,r,h,s,o,a,l].map(Math.round);const[c,f]=[Math.abs(n-i)/Math.abs(s-o),Math.abs(r-h)/Math.abs(a-l)];if(c===f){const[t,e]=[n,i].sort((t,e)=>e-t),[f,d]=[s,o].sort((t,e)=>e-t);return 0===c?(a<=f&&a>=d||l<=f&&l>=d)&&n===r:c===1/0?(r<=t&&r>=e||h<=t&&h>=e)&&s===a:r<=t&&r>=e&&a<=f&&a>=d||h<=t&&h>=e||l<=f&&l>=d}c===1/0&&(s+=1e-4),f===1/0&&(a+=1e-4),0===c&&(n+=1e-4),0===f&&(r+=1e-4);const d=((n*o-s*i)*(r-h)-(n-i)*(r*l-a*h))/((n-i)*(a-l)-(s-o)*(r-h)),u=((n*o-s*i)*(a-l)-(s-o)*(r*l-a*h))/((n-i)*(a-l)-(s-o)*(r-h));if(isNaN(d)||isNaN(u))return!1;if(n>=i){if(!(i<=d&&d<=n))return!1}else if(!(n<=d&&d<=i))return!1;if(s>=o){if(!(o<=u&&u<=s))return!1}else if(!(s<=u&&u<=o))return!1;if(r>=h){if(!(h<=d&&d<=r))return!1}else if(!(r<=d&&d<=h))return!1;if(a>=l){if(!(l<=u&&u<=a))return!1}else if(!(a<=u&&u<=l))return!1;return!0}e.isBox=o,e.isLine=function(t){return"object"==typeof t&&"number"==typeof t.startX&&"number"==typeof t.startY&&"number"==typeof t.endX&&"number"==typeof t.endY},e.box2Lines=r,e.countBox=function(t){const e=getComputedStyle(t);return{x:parseFloat(e.left),y:parseFloat(e.top),width:parseFloat(e.width),height:parseFloat(e.height)}},e.deepAssign=function t(...e){const n=e.shift();for(const s of e)for(const[e,i]of Object.entries(s))e in n?Array.isArray(i)&&Array.isArray(n[e])?n[e].push(...i):"object"==typeof i&&"object"==typeof n[e]?t(n[e],i):n[e]=i:n[e]=i;return n},e.timeNodeGetter=function(){const t=function(t,e,n){const s=function(t){const e=new Date(t);return e.setFullYear(t.getFullYear()-1,0,1),e.setHours(0,0,0,0),e}(t),i=function(t){const e=new Date(t);return e.setFullYear(t.getFullYear()+1,0,1),e.setHours(0,0,0,0),e}(e),o=[];{const t=new Date(s);for(;t.getFullYear()<=i.getFullYear();)o.push(new Date(t)),n(t)}return o.filter(n=>n.getTime()<e.getTime()&&n.getTime()>t.getTime())};return{year:(e,n)=>t(e,n,t=>t.setFullYear(t.getFullYear()+1)),quarter:(e,n)=>t(e,n,t=>{t.getMonth()+3>=12?(t.setFullYear(t.getFullYear()+1),t.setMonth(0,1)):t.setMonth(t.getMonth()+3,1)}),month:(e,n)=>t(e,n,t=>{11===t.getMonth()?(t.setFullYear(t.getFullYear()+1),t.setMonth(0,1)):t.setMonth(t.getMonth()+1,1)}),week:(e,n)=>t(e,n,t=>{do{t.setTime(t.getTime()+864e5)}while(1!==t.getDay())}),day:(e,n)=>t(e,n,t=>t.setTime(t.getTime()+864e5))}}(),e.mergeBox=function(...t){const e={x:1/0,y:1/0},n={x:-1/0,y:-1/0};for(const s of t)s.x<e.x&&(e.x=s.x),s.y<e.y&&(e.y=s.y),s.x+s.width>n.x&&(n.x=s.x+s.width),s.y+s.height>n.y&&(n.y=s.y+s.height);return{x:e.x,y:e.y,width:n.x-e.x,height:n.y-e.y}},e.isIntersecting=a,e.isOverlap=function(t,e){const n=o(t)?r(t):[t],s=o(e)?r(e):[e];return n.some(t=>s.some(e=>a(t,e)))},e.drawLine=function(t,e){t.beginPath(),t.setLineDash([]),t.lineWidth=3,t.strokeStyle="#f00",t.moveTo(e.startX,e.startY),t.lineTo(e.endX,e.endY),t.stroke()},e.walkLoop=function(t,e=10){return s(this,void 0,void 0,function*(){let n=!1;for(let s=0;s<e;s++){const e=yield t();if(e.includes("alleviated"))n=!0;else{if(e.every(t=>"no-conflict"===t))return"no-conflict";if(e.includes("failed"))return n?"alleviated":"failed"}}throw new Error("too many loop")})},e.createLogFunction=function(t){return function(e,...n){if(!i.DEBUG)return;const s=[e[0]];for(let t=0;t<n.length;t++)s.push(n[t],e[t+1]);console.log(`${t} #`,...s)}},e.deepFreeze=function t(e){const n=JSON.parse(JSON.stringify(e)),s=Object.getOwnPropertyNames(n);for(const e of s){const s=n[e];n[e]=s&&"object"==typeof s?t(s):s}return Object.freeze(n)},e.shrinkBox=function(t,e=1){return{x:t.x+e,y:t.y+e,width:t.width-2*e,height:t.height-2*e}}},function(t,e,n){"use strict";var s=this&&this.__awaiter||function(t,e,n,s){return new(n||(n=Promise))(function(i,o){function r(t){try{h(s.next(t))}catch(t){o(t)}}function a(t){try{h(s.throw(t))}catch(t){o(t)}}function h(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(r,a)}h((s=s.apply(t,e||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0});const i=n(0),o=n(1);e.default=class{constructor({ext:t,canvas:e,container:n,grid:s}){if(this.extraData={},this.destroyed=!1,!(this.constructor.name in i.SN))throw new TypeError(`Class name "${this.constructor.name}" illegal, `+`it must following ${Object.keys(i.SN)}`);this.name=i.SN[this.constructor.name],this.ext=t,this.grid=s,this.canvas=e,this.container=n,this.ext.onConstruct(this)}draw(){this.checkDestroy(),this.ext.onDraw(this)}createElement(){this.element&&this.container.removeChild(this.element),this.element=document.createElement("div"),this.element.classList.add("short-night",this.theme,this.name),this.container.appendChild(this.element)}hide(){this.checkDestroy(),this.element&&(this.element.style.visibility="hidden"),this.canvas.getContext("2d").clearRect(0,0,this.canvas.width,this.canvas.height),this.ext.onHide(this)}apply(...t){return s(this,void 0,void 0,function*(){this.checkDestroy(),this.element&&(this.drawInfo.box=o.mergeBox(this.drawInfo.box,o.countBox(this.element))),yield this.ext.onApply(this)})}destroy(){this.checkDestroy(),this.destroyed=!0,this.ext.onDestroy(this)}l(t,...e){if(!i.DEBUG)return;const n=[t[0]];for(let s=0;s<e.length;s++)n.push(e[s],t[s+1]);console.log(`${this.name} #`,...n)}checkDestroy(){if(this.destroyed)throw new Error(`${this.name} has bean destroyed, however, you still call it's method.`)}from(t){return this.drawInfo=t,this}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),console.log("The night is short, walk on girl."),n(37);var s=n(6);e.Timeline=s.default;var i=n(5);e.Axis=i.default;var o=n(12);e.AxisScale=o.default;var r=n(13);e.AxisMilestone=r.default;var a=n(7);e.AxisBody=a.default;var h=n(14);e.Event=h.default;var l=n(15);e.EventMark=l.default;var c=n(16);e.EventAxis=c.default;var f=n(17);e.EventBody=f.default;var d=n(2);e.Component=d.default;var u=n(20);e.ExtensionManager=u.ExtensionManager,e.BoxElementGenerator=u.BoxElementGenerator,e.GeneratorId=u.GeneratorId,e.PositionCounter=u.PositionCounter,e.BreakpointAnimation=u.BreakpointAnimation,e.ConflictFixer=u.ConflictFixer},function(t,e,n){"use strict";var s=this&&this.__awaiter||function(t,e,n,s){return new(n||(n=Promise))(function(i,o){function r(t){try{h(s.next(t))}catch(t){o(t)}}function a(t){try{h(s.throw(t))}catch(t){o(t)}}function h(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(r,a)}h((s=s.apply(t,e||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0});const i=n(0),o=n(40),r=n(5),a=n(7),h=n(6);var l;!function(t){t.PushScalesAndMilestones="PushScalesAndMilestones",t.FixEventBody2AxisMilestone="FixEventBody2AxisMilestone",t.FixEventAxis2EventAxis="FixEventAxis2EventAxis",t.FixEventBody2EventBodyMover="FixEventBody2EventBodyMover",t.FixEventBody2EventBodyFloater="FixEventBody2EventBodyFloater",t.DrawFrom="DrawFrom",t.Debug="Debug"}(l=e.Breakpoint||(e.Breakpoint={}));class c{constructor(t,{breakpoints:e=[],playAnimation:n=!1}={}){this.etx=t,this.stepIn=null,this.breakpoints=e,this.playAnimation=n,this.playAnimation&&0===this.breakpoints.length&&(this.breakpoints=c.defaultAnimationBreakpoints),i.DEBUG&&(this.breakpoints.push(l.Debug),window.next=this.next.bind(this),window.abort=(()=>{delete this.stepIn}))}onDraw(t){h.default.is(t)&&this.playAnimation&&(new o).move(this.etx.components[i.SN.Timeline][0].canvas)}next(){this.stepIn?(this.stepIn(),this.stepIn=null):console.error("cannot next")}block(t,{onBlock:e,onNext:n,components:i=[],protagonist:h,forward:c=!1}={}){return s(this,void 0,void 0,function*(){const f=t===l.DrawFrom?300:c?200:300;if(this.breakpoints.includes(t)){if(console.log(`blocking at ${t}`),this.playAnimation){const t=function(){if(h)return h.drawInfo.box.y-100;if(i&&i.length)return(t=>t.find(e=>t.every(t=>e.drawInfo.box.y>=t.drawInfo.box.y)))(i.filter(t=>!r.default.is(t)&&!a.default.is(t))).drawInfo.box.x-100;return null}();t&&!c?new o({duration:500}).move(t-document.documentElement.scrollTop,{callback:()=>setTimeout(()=>this.next(),f)}):setTimeout(()=>this.next(),f)}return(()=>s(this,void 0,void 0,function*(){e&&(yield e()),yield Promise.all(i.map(t=>t.draw())),yield new Promise(t=>{this.stepIn=(()=>s(this,void 0,void 0,function*(){n&&(yield n()),yield Promise.all(i.map(t=>t.hide())),t()}))})}))()}})}}c.defaultAnimationBreakpoints=[l.FixEventBody2AxisMilestone,l.FixEventAxis2EventAxis,l.FixEventBody2EventBodyMover,l.FixEventBody2EventBodyFloater,l.DrawFrom],e.default=c},function(t,e,n){"use strict";var s=this&&this.__awaiter||function(t,e,n,s){return new(n||(n=Promise))(function(i,o){function r(t){try{h(s.next(t))}catch(t){o(t)}}function a(t){try{h(s.throw(t))}catch(t){o(t)}}function h(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(r,a)}h((s=s.apply(t,e||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0});const i=n(2),o=n(0),r=n(1);e.default=class extends i.default{constructor(){super(...arguments),this.name=o.SN.Axis,this.drawInfo={scales:[],milestones:[],length:0,box:{x:0,y:0,width:0,height:0}},this.milestones=[],this.scales=[],this.body=null}apply(){const t=t=>super[t];return s(this,void 0,void 0,function*(){this.body||(this.body=new this.bodyConstructor(this)),this.body.drawInfo.length=this.drawInfo.length,yield this.body.apply(),this.milestones.forEach(t=>t.destroy()),this.milestones.length=0,this.scales.forEach(t=>t.destroy()),this.scales.length=0;for(const t of this.drawInfo.scales){if(this.drawInfo.milestones.some(e=>e.position===t))continue;const e=new this.scaleConstructor(this);e.drawInfo.bodyDrawInfo=r.deepFreeze(this.body.drawInfo),e.drawInfo.alignY=t,e.drawInfo.height=this.grid.scaleHeight,this.scales.push(e)}for(const{position:t,text:e}of this.drawInfo.milestones){const n=new this.milestoneConstructor(this);n.drawInfo.bodyDrawInfo=r.deepFreeze(this.body.drawInfo),n.drawInfo.alignY=t,n.drawInfo.text=e,this.milestones.push(n)}return yield Promise.all([this.milestones.map(t=>t.apply()),this.scales.map(t=>t.apply())]),this.drawInfo.box=r.mergeBox(this.body.drawInfo.box,...this.milestones.map(t=>t.drawInfo.box),...this.scales.map(t=>t.drawInfo.box)),t("apply").call(this)})}draw(){return this.body.draw(),this.scales.forEach(t=>t.draw()),this.milestones.forEach(t=>t.draw()),super.draw()}destroy(){return this.body.destroy(),this.scales.forEach(t=>t.destroy()),this.milestones.forEach(t=>t.destroy()),super.destroy()}hide(){return this.body.hide(),this.scales.forEach(t=>t.hide()),this.milestones.forEach(t=>t.hide()),super.hide()}static is(t){return t.name===o.SN.Axis}}},function(t,e,n){"use strict";var s=this&&this.__awaiter||function(t,e,n,s){return new(n||(n=Promise))(function(i,o){function r(t){try{h(s.next(t))}catch(t){o(t)}}function a(t){try{h(s.throw(t))}catch(t){o(t)}}function h(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(r,a)}h((s=s.apply(t,e||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0});const i=n(2),o=n(1),r=n(0),a=n(4);class h extends i.default{constructor(){super(...arguments),this.name=r.SN.Timeline,this.grid=h.defaultGrid,this.runtime={},this.drawInfo={box:{x:0,y:0,width:0,height:0},events:[]},this.events=[],this.axis=null}countStartData(){const t=Array.from(this.drawInfo.events).sort((t,e)=>Number(new Date(t.date))-Number(new Date(e.date)));return new Date(t[0].date)}countEndData(){const t=this.drawInfo.events,e=Math.max(...t.map(t=>Number(new Date(t.date)))),n=Math.max(...t.filter(t=>"endDate"in t).map(t=>Number(new Date(t.endDate))))||-1;return new Date(Math.max(e,n))}countMilestoneBy(){const t=new Date(this.runtime.endDate).getTime()-new Date(this.runtime.startDate).getTime();switch(!0){case t>62208e6:return"year";case t>15552e6:return"quarter";case t>5184e6:return"month";case t>12096e5:return"week"}return null}countScaleBy(){switch(this.runtime.milestoneBy){case"year":return"quarter";case"quarter":return"month";case"month":return"week";case"week":return"day"}return null}countAxisLength(){return 500+100*this.drawInfo.events.length}initRuntime(t){return this.runtime=Object.create(t||Object.prototype),this.runtime.startDate="startDate"in this.runtime?new Date(this.runtime.startDate).toISOString():this.countStartData().toISOString(),this.runtime.endDate="endDate"in this.runtime?new Date(this.runtime.endDate).toISOString():this.countEndData().toISOString(),this.runtime.milestoneBy="milestoneBy"in this.runtime?this.runtime.milestoneBy:this.countMilestoneBy(),this.runtime.scaleBy="scaleBy"in this.runtime?this.runtime.scaleBy:this.countScaleBy(),this.runtime.axisLength="axisLength"in this.runtime?this.runtime.axisLength:this.countAxisLength(),this.runtime.startDate=new Date(new Date(this.runtime.startDate).getTime()-r.DATE_COUNT_EXTRA[this.runtime.scaleBy||"day"]).toISOString(),this.runtime.endDate=new Date(new Date(this.runtime.endDate).getTime()+r.DATE_COUNT_EXTRA[this.runtime.scaleBy||"day"]).toISOString(),t}apply(t){const e=t=>super[t];return s(this,void 0,void 0,function*(){return this.initRuntime(t),this.canvas.width=this.grid.canvasWidth,this.canvas.height=this.runtime.axisLength+2*this.grid.axisStart.y,this.axis||(this.axis=new this.axisConstructor(this)),yield this.updateAxis(),this.events.forEach(t=>t.destroy()),this.events.length=0,yield this.createEvents(),e("apply").call(this)})}draw(){return this.axis.draw(),this.events.forEach(t=>t.draw()),super.draw()}hide(){return this.events.forEach(t=>t.hide()),this.axis.hide(),super.hide()}updateAxis(){return s(this,void 0,void 0,function*(){const t=new Date(this.runtime.endDate).getTime(),e=new Date(this.runtime.startDate).getTime(),n=t-e;this.axis.drawInfo.length=this.runtime.axisLength,null!==this.runtime.milestoneBy&&(this.axis.drawInfo.milestones=o.timeNodeGetter[this.runtime.milestoneBy](new Date(e),new Date(t)).map(e=>{const s={position:(t-e.getTime())/n,text:""},i=e.toDateString().split(" ")[1];switch(this.runtime.milestoneBy){case"year":s.text=`${e.getFullYear()}`;break;case"quarter":s.text=`${i}. ${e.getFullYear()}`;break;case"month":s.text=`${i}.`;break;case"week":case"day":s.text=`${e.getMonth()+1}.${e.getDate()}`}return s})),null!==this.runtime.scaleBy&&(this.axis.drawInfo.scales=o.timeNodeGetter[this.runtime.scaleBy](new Date(this.runtime.startDate),new Date(this.runtime.endDate)).map(t=>(new Date(this.runtime.endDate).getTime()-t.getTime())/n)),yield this.axis.apply()})}createEvents(){return s(this,void 0,void 0,function*(){const t=Array.from(this.drawInfo.events).sort((t,e)=>new Date(t.date).getTime()-new Date(e.date).getTime()),e=new Date(this.runtime.endDate).getTime()-new Date(this.runtime.startDate).getTime();for(const n of t){const t=new this.eventConstructor(this);if(t.drawInfo.target={x:this.axis.body.drawInfo.box.x+this.axis.body.drawInfo.box.width/2,y:(new Date(this.runtime.endDate).getTime()-new Date(n.date).getTime())/e},t.drawInfo.bodyWidth=this.grid.eventWidth,t.drawInfo.date=n.date,t.drawInfo.title=n.title,t.drawInfo.contentText=n.text,t.drawInfo.folded=Boolean(n.folded),t.drawInfo.foldedText=n.foldedText,t.drawInfo.axisText=n.endText,n.endDate){const s=new Date("now"===n.endDate?this.runtime.endDate:n.endDate);t.drawInfo.axisLength=(s.getTime()-new Date(n.date).getTime())/e}yield t.apply(),this.events.push(t)}})}static is(t){return t.name===r.SN.Timeline}drawFrom(t){return s(this,void 0,void 0,function*(){const e="string"==typeof t?JSON.parse(t).data:t.data,n=new this.axisConstructor(this),s=new this.eventConstructor(this);this.canvas.width=e.width,this.canvas.height=e.height;const i=[];{const{bodyDrawInfo:t,scalesDrawInfo:s,milestonesDrawInfo:o}=e.axis;i.push(new n.bodyConstructor(this).from(t));const r=[];s.forEach(t=>{r.push(new n.scaleConstructor(this).from(t))}),o.forEach(t=>{r.push(new n.milestoneConstructor(this).from(t))}),r.sort((t,e)=>t.drawInfo.alignY-e.drawInfo.alignY),i.push(...r)}const o=Array.from(e.events).sort((t,e)=>t.drawInfo.target.y-e.drawInfo.target.y);for(const{bodyDrawInfo:t,markDrawInfo:e,axisDrawInfo:n}of o)i.push(new s.markConstructor(this).from(e)),i.push(new s.bodyConstructor(this).from(t)),null!==n&&i.push(new s.axisConstructor(this).from(n));for(const t of i)yield this.ext.breakpoint.block(a.Breakpoint.DrawFrom),t.draw()})}export(){const t=this.ext.components[r.SN.Timeline][0];return o.deepFreeze(JSON.parse(JSON.stringify({theme:t.theme,version:r.SN_VERSION,data:{width:t.canvas.width,height:t.canvas.height,timeline:t.drawInfo,runtime:t.runtime,events:t.events.map(t=>({drawInfo:t.drawInfo,bodyDrawInfo:t.body.drawInfo,markDrawInfo:t.mark.drawInfo,axisDrawInfo:t.axis?t.axis.drawInfo:null})),axis:{drawInfo:t.axis.drawInfo,bodyDrawInfo:t.axis.body.drawInfo,scalesDrawInfo:t.axis.scales.map(t=>t.drawInfo),milestonesDrawInfo:t.axis.milestones.map(t=>t.drawInfo)}}})))}}h.defaultGrid={eventOffset:{x:20,y:0},minEventAxisOffset:25,markWidth:15,scaleHeight:5,axisWidth:12,axisStart:{x:400,y:10},eventWidth:350,canvasWidth:700},e.default=h},function(t,e,n){"use strict";var s=this&&this.__awaiter||function(t,e,n,s){return new(n||(n=Promise))(function(i,o){function r(t){try{h(s.next(t))}catch(t){o(t)}}function a(t){try{h(s.throw(t))}catch(t){o(t)}}function h(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(r,a)}h((s=s.apply(t,e||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0});const i=n(2),o=n(0);e.default=class extends i.default{constructor(){super(...arguments),this.name=o.SN.AxisBody,this.drawInfo={box:{x:0,y:0,width:0,height:0},length:0}}apply(){const t=t=>super[t];return s(this,void 0,void 0,function*(){return this.drawInfo.box={x:this.grid.axisStart.x-this.grid.axisWidth/2,y:this.grid.axisStart.y,width:this.grid.axisWidth,height:this.drawInfo.length},t("apply").call(this)})}static is(t){return t.name===o.SN.AxisBody}}},function(t,e,n){"use strict";var s=this&&this.__awaiter||function(t,e,n,s){return new(n||(n=Promise))(function(i,o){function r(t){try{h(s.next(t))}catch(t){o(t)}}function a(t){try{h(s.throw(t))}catch(t){o(t)}}function h(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(r,a)}h((s=s.apply(t,e||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(t){this.etx=t}onApply(t){return s(this,void 0,void 0,function*(){let e=t.extraData.boxElement;e||((e=document.createElement(t.name)).id=t.extraData.id,t.extraData.boxElement=e);for(const[n,s]of Object.entries(t.drawInfo))void 0!==s&&(e.dataset[n]=JSON.stringify(s));Object.assign(e.style,{position:"absolute",left:`${t.drawInfo.box.x}px`,top:`${t.drawInfo.box.y}px`,width:`${t.drawInfo.box.width}px`,height:`${t.drawInfo.box.height}px`,zIndex:9999999-~~(t.drawInfo.box.width*t.drawInfo.box.height)}),t.container.appendChild(e)})}onDestroy(t){const e=t.extraData.boxElement;e&&e.parentNode&&e.parentNode.removeChild(e)}}},function(t,e,n){"use strict";var s=this&&this.__awaiter||function(t,e,n,s){return new(n||(n=Promise))(function(i,o){function r(t){try{h(s.next(t))}catch(t){o(t)}}function a(t){try{h(s.throw(t))}catch(t){o(t)}}function h(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(r,a)}h((s=s.apply(t,e||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0});const i=n(0);e.default=class{constructor(t){this.etx=t}onConstruct(t){const e=Number(Math.random().toString().split(".")[1]).toString(36).slice(0,5);Object.defineProperty(t.extraData,"id",{get:()=>`${t.name}_${e}`})}onApply(t){return s(this,void 0,void 0,function*(){i.DEBUG&&(window[t.extraData.id]=t)})}}},function(t,e,n){"use strict";var s=this&&this.__awaiter||function(t,e,n,s){return new(n||(n=Promise))(function(i,o){function r(t){try{h(s.next(t))}catch(t){o(t)}}function a(t){try{h(s.throw(t))}catch(t){o(t)}}function h(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(r,a)}h((s=s.apply(t,e||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0});const i=n(5),o=n(1),r=n(4),a=n(0),h=n(6);e.default=class{constructor(t){this.etx=t,this.pushConfigs=[]}adjustAxis(t){return s(this,void 0,void 0,function*(){const e=[t.body,...t.scales,...t.milestones];t.extraData.realLength=t.drawInfo.length-t.milestones.reduce((t,e)=>t+e.drawInfo.box.height,0),t.milestones.forEach(e=>e.drawInfo.alignY*=t.extraData.realLength),t.scales.forEach(e=>e.drawInfo.alignY*=t.extraData.realLength),yield Promise.all([...t.milestones,...t.scales].map(t=>t.apply())),t.milestones.forEach(t=>this.addPushConfig({critical:t.drawInfo.box.y,additional:t.drawInfo.box.height,component:t})),yield this.etx.breakpoint.block(r.Breakpoint.PushScalesAndMilestones,{components:e});const n=[...t.milestones,...t.scales].sort((t,e)=>t.drawInfo.alignY-e.drawInfo.alignY);for(const t of n){const s=this.countCritical(t.drawInfo.alignY);0!==s&&(t.name===a.SN.AxisMilestone&&(yield Promise.all(n.map(t=>t.apply())),yield this.etx.breakpoint.block(r.Breakpoint.PushScalesAndMilestones,{components:e})),t.drawInfo.alignY+=s)}yield Promise.all(n.map(t=>t.apply())),yield this.etx.breakpoint.block(r.Breakpoint.PushScalesAndMilestones,{components:e}),yield Promise.all(e.map(t=>t.apply())),t.drawInfo.box=o.mergeBox(...e.map(t=>t.drawInfo.box))})}adjustEvent(t){return s(this,void 0,void 0,function*(){const e=t.events,n=this.etx.components[a.SN.Axis][0];for(const t of e)t.drawInfo.target.y*=n.extraData.realLength,t.drawInfo.target.y+=n.body.drawInfo.box.y,t.drawInfo.target.y+=this.countCritical(t.drawInfo.target.y),t.drawInfo.axisLength&&(t.drawInfo.axisLength*=n.extraData.realLength,t.drawInfo.axisLength+=this.countCritical(t.drawInfo.target.y));yield Promise.all(e.map(t=>t.apply()))})}onApply(t){return s(this,void 0,void 0,function*(){return i.default.is(t)?yield this.adjustAxis(t):h.default.is(t)?yield this.adjustEvent(t):void 0})}onDestroy(t){for(;;){const e=this.pushConfigs.findIndex(e=>e.component===t);if(-1===e)break;this.pushConfigs.splice(e,1)}}addPushConfig(t){this.pushConfigs.push(t)}countCritical(t){return 0===this.pushConfigs.length?t:this.pushConfigs.reduce((e,n)=>t>n.critical?e+n.additional:e,0)}}},function(t,e,n){"use strict";var s=this&&this.__awaiter||function(t,e,n,s){return new(n||(n=Promise))(function(i,o){function r(t){try{h(s.next(t))}catch(t){o(t)}}function a(t){try{h(s.throw(t))}catch(t){o(t)}}function h(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(r,a)}h((s=s.apply(t,e||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0});const i=n(0),o=n(6),r=n(1),a=n(41),h=n(42),l=n(43),c=n(44);e.default=class{constructor(t){this.ext=t,this.fixers=[new a.default(this.ext),new h.default(this.ext),new l.default(this.ext),new c.default(this.ext)],this.counter=0}onApply(t){return s(this,void 0,void 0,function*(){if(o.default.is(t)){if("no-conflict"!==(yield this.fixAll())){if(++this.counter>10){const t="Too many times of try fix conflict.";if(i.DEBUG)throw new Error(t);console.warn(t)}return Promise.resolve().then(()=>t.apply({axisLength:1.1*t.runtime.axisLength}))}this.counter=0}})}fixAll(){return s(this,void 0,void 0,function*(){return yield r.walkLoop(()=>s(this,void 0,void 0,function*(){const t=[];for(const e of this.fixers)t.push(yield e.fix());return t}))})}}},function(t,e,n){"use strict";var s=this&&this.__awaiter||function(t,e,n,s){return new(n||(n=Promise))(function(i,o){function r(t){try{h(s.next(t))}catch(t){o(t)}}function a(t){try{h(s.throw(t))}catch(t){o(t)}}function h(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(r,a)}h((s=s.apply(t,e||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0});const i=n(2),o=n(0);e.default=class extends i.default{constructor(){super(...arguments),this.name=o.SN.AxisScale,this.drawInfo={bodyDrawInfo:{},alignY:0,height:0,box:{x:0,y:0,width:0,height:0}}}apply(){const t=t=>super[t];return s(this,void 0,void 0,function*(){return this.drawInfo.box={x:this.drawInfo.bodyDrawInfo.box.x,y:this.drawInfo.alignY-this.drawInfo.height/2,height:this.drawInfo.height,width:this.drawInfo.bodyDrawInfo.box.width},t("apply").call(this)})}static is(t){return t.name===o.SN.AxisScale}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=n(1),i=n(2),o=n(0);e.default=class extends i.default{constructor(){super(...arguments),this.name=o.SN.AxisMilestone,this.drawInfo={bodyDrawInfo:{},alignY:0,text:"0_o",box:{x:0,y:0,width:0,height:0}}}apply(){return this.createElement(),this.element.style.visibility="hidden",this.drawInfo.box=s.countBox(this.element),super.apply()}static is(t){return t.name===o.SN.AxisMilestone}createElement(){super.createElement(),this.element.innerHTML=this.drawInfo.text;const{width:t,height:e}=s.countBox(this.element),n=this.drawInfo.bodyDrawInfo.box.x+this.drawInfo.bodyDrawInfo.box.width/2-t/2,i=this.drawInfo.alignY-e/2;this.element.style.left=`${n}px`,this.element.style.top=`${i}px`}draw(){return this.createElement(),super.draw()}}},function(t,e,n){"use strict";var s=this&&this.__awaiter||function(t,e,n,s){return new(n||(n=Promise))(function(i,o){function r(t){try{h(s.next(t))}catch(t){o(t)}}function a(t){try{h(s.throw(t))}catch(t){o(t)}}function h(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(r,a)}h((s=s.apply(t,e||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0});const i=n(2),o=n(1),r=n(0);e.default=class extends i.default{constructor(){super(...arguments),this.name=r.SN.Event,this.drawInfo={target:{x:30,y:50},offset:this.grid.eventOffset,bodyWidth:300,date:null,title:null,folded:!1,foldedText:null,box:{x:0,y:0,width:500,height:500}},this.mark=null,this.body=null,this.axis=null}apply(){const t=t=>super[t];return s(this,void 0,void 0,function*(){if(this.mark||(this.mark=new this.markConstructor(this)),this.mark.drawInfo.target=this.drawInfo.target,this.mark.drawInfo.width=this.grid.markWidth,this.mark.drawInfo.height=this.grid.markHeight,yield this.mark.apply(),this.body||(this.body=new this.bodyConstructor(this)),this.body.drawInfo.markDrawInfo=o.deepFreeze(this.mark.drawInfo),this.body.drawInfo.maxWidth=this.grid.eventWidth,this.body.drawInfo.date=this.drawInfo.date,this.body.drawInfo.title=this.drawInfo.title,this.body.drawInfo.contentText=this.drawInfo.contentText,this.body.drawInfo.folded=this.drawInfo.folded,this.body.drawInfo.foldedText=this.drawInfo.foldedText,this.body.drawInfo.offset=Object.assign({},this.drawInfo.offset),yield this.body.apply(),this.drawInfo.axisLength){const t=this.axis||new this.axisConstructor(this);t.drawInfo.axisBodyDrawInfo=o.deepFreeze(this.ext.components[r.SN.Axis][0].drawInfo),t.drawInfo.markDrawInfo=o.deepFreeze(this.mark.drawInfo),t.drawInfo.offsetX=this.grid.minEventAxisOffset,t.drawInfo.length=this.drawInfo.axisLength,t.drawInfo.text=this.drawInfo.axisText,yield t.apply(),this.axis=t}else this.axis&&(this.axis.destroy(),this.axis=null);return this.drawInfo.box=o.mergeBox(this.body.drawInfo.box,this.mark.drawInfo.box),this.axis&&(this.drawInfo.box=o.mergeBox(this.drawInfo.box,this.axis.drawInfo.box)),t("apply").call(this)})}destroy(){return this.mark.destroy(),this.body.destroy(),this.axis&&this.axis.destroy(),super.destroy()}hide(){return this.mark.hide(),this.body.hide(),this.axis&&this.axis.hide(),super.hide()}draw(){return this.body.draw(),this.axis&&this.axis.draw(),this.mark.draw(),super.draw()}static is(t){return t.name===r.SN.Event}}},function(t,e,n){"use strict";var s=this&&this.__awaiter||function(t,e,n,s){return new(n||(n=Promise))(function(i,o){function r(t){try{h(s.next(t))}catch(t){o(t)}}function a(t){try{h(s.throw(t))}catch(t){o(t)}}function h(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(r,a)}h((s=s.apply(t,e||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0});const i=n(2),o=n(0);e.default=class extends i.default{constructor(){super(...arguments),this.name=o.SN.EventMark,this.drawInfo={axisBodyDrawInfo:{},box:{x:0,y:0,width:0,height:0},target:{x:0,y:0},width:0}}apply(){const t=t=>super[t];return s(this,void 0,void 0,function*(){const e=this.drawInfo.width,n=this.drawInfo.height||e;return this.drawInfo.box={width:e,height:n,x:this.drawInfo.target.x-e/2,y:this.drawInfo.target.y-n/2},t("apply").call(this)})}static is(t){return t.name===o.SN.EventMark}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=n(1),i=n(2),o=n(0);e.default=class extends i.default{constructor(){super(...arguments),this.name=o.SN.EventAxis,this.drawInfo={axisBodyDrawInfo:{},markDrawInfo:{},length:0,offsetX:0,box:{x:0,y:0,width:0,height:0}}}apply(){this.drawInfo.text?(this.createElement(),this.element.style.visibility="hidden"):this.element&&(this.element.parentNode.removeChild(this.element),delete this.element);const t=this.drawInfo.markDrawInfo.target;return this.drawInfo.box={x:t.x,y:t.y-this.drawInfo.length,width:this.drawInfo.offsetX,height:this.drawInfo.length},super.apply()}createElement(){super.createElement();const t=this.drawInfo.markDrawInfo.target;this.element.classList.add("event_axis-endText"),this.element.innerHTML=this.drawInfo.text;const e=s.countBox(this.element);this.element.style.left=`${t.x+this.drawInfo.offsetX}px`,this.element.style.top=`${t.y-this.drawInfo.length-e.height/2}px`}static is(t){return t.name===o.SN.EventAxis}draw(){return this.drawInfo.text&&this.createElement(),super.draw()}}},function(t,e,n){"use strict";var s=this&&this.__awaiter||function(t,e,n,s){return new(n||(n=Promise))(function(i,o){function r(t){try{h(s.next(t))}catch(t){o(t)}}function a(t){try{h(s.throw(t))}catch(t){o(t)}}function h(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(r,a)}h((s=s.apply(t,e||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0});const i=n(1),o=n(2),r=n(0);e.default=class extends o.default{constructor(){super(...arguments),this.name=r.SN.EventBody,this.element=null,this.drawInfo={markDrawInfo:null,offset:{x:0,y:0},maxWidth:300,date:null,title:"untitled",floated:!1,folded:!1,box:{x:0,y:0,width:300,height:0}}}resetElement(){this.drawInfo.folded?this.element.innerHTML=`\n                <h4 class="foldedText">${this.drawInfo.foldedText||this.drawInfo.title}</h4>\n                <h5 class="date">${new Date(this.drawInfo.date).toDateString()}</h5>\n            `:this.element.innerHTML=`\n                <h4 class="title">${this.drawInfo.title}</h4>\n                <h5 class="date">${new Date(this.drawInfo.date).toDateString()}</h5>\n                ${this.drawInfo.contentText?`<p>${this.drawInfo.contentText}</p>`:""}\n            `,this.drawInfo.folded?this.element.classList.add("folded"):this.element.classList.remove("folded"),Object.assign(this.element.style,{left:0,top:0,width:null,height:null,maxWidth:`${this.drawInfo.maxWidth}px`})}initBoxFromElement(){const t=i.countBox(this.element),e=Object.assign({width:t.width,height:t.height},this.drawInfo.markDrawInfo.target);e.x-=e.width,e.y-=e.height/2,e.x-=this.drawInfo.offset.x,e.y+=this.drawInfo.offset.y,this.drawInfo.box=e}apply(){const t=t=>super[t];return s(this,void 0,void 0,function*(){return this.createElement(),this.initBoxFromElement(),this.createElement(),this.element.style.visibility="hidden",t("apply").call(this)})}createElement(){super.createElement(),this.resetElement(),this.element.style.left=`${this.drawInfo.box.x}px`,this.element.style.top=`${this.drawInfo.box.y}px`}static is(t){return t.name===r.SN.EventBody}draw(){return this.createElement(),super.draw()}}},function(t,e){t.exports=function(t){var e=[];return e.toString=function(){return this.map(function(e){var n=function(t,e){var n=t[1]||"",s=t[3];if(!s)return n;if(e&&"function"==typeof btoa){var i=(r=s,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(r))))+" */"),o=s.sources.map(function(t){return"/*# sourceURL="+s.sourceRoot+t+" */"});return[n].concat(o).concat([i]).join("\n")}var r;return[n].join("\n")}(e,t);return e[2]?"@media "+e[2]+"{"+n+"}":n}).join("")},e.i=function(t,n){"string"==typeof t&&(t=[[null,t,""]]);for(var s={},i=0;i<this.length;i++){var o=this[i][0];"number"==typeof o&&(s[o]=!0)}for(i=0;i<t.length;i++){var r=t[i];"number"==typeof r[0]&&s[r[0]]||(n&&!r[2]?r[2]=n:n&&(r[2]="("+r[2]+") and ("+n+")"),e.push(r))}},e}},function(t,e,n){var s,i,o={},r=(s=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===i&&(i=s.apply(this,arguments)),i}),a=function(t){var e={};return function(t,n){if("function"==typeof t)return t();if(void 0===e[t]){var s=function(t,e){return e?e.querySelector(t):document.querySelector(t)}.call(this,t,n);if(window.HTMLIFrameElement&&s instanceof window.HTMLIFrameElement)try{s=s.contentDocument.head}catch(t){s=null}e[t]=s}return e[t]}}(),h=null,l=0,c=[],f=n(35);function d(t,e){for(var n=0;n<t.length;n++){var s=t[n],i=o[s.id];if(i){i.refs++;for(var r=0;r<i.parts.length;r++)i.parts[r](s.parts[r]);for(;r<s.parts.length;r++)i.parts.push(x(s.parts[r],e))}else{var a=[];for(r=0;r<s.parts.length;r++)a.push(x(s.parts[r],e));o[s.id]={id:s.id,refs:1,parts:a}}}}function u(t,e){for(var n=[],s={},i=0;i<t.length;i++){var o=t[i],r=e.base?o[0]+e.base:o[0],a={css:o[1],media:o[2],sourceMap:o[3]};s[r]?s[r].parts.push(a):n.push(s[r]={id:r,parts:[a]})}return n}function p(t,e){var n=a(t.insertInto);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var s=c[c.length-1];if("top"===t.insertAt)s?s.nextSibling?n.insertBefore(e,s.nextSibling):n.appendChild(e):n.insertBefore(e,n.firstChild),c.push(e);else if("bottom"===t.insertAt)n.appendChild(e);else{if("object"!=typeof t.insertAt||!t.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var i=a(t.insertAt.before,n);n.insertBefore(e,i)}}function y(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t);var e=c.indexOf(t);e>=0&&c.splice(e,1)}function w(t){var e=document.createElement("style");if(void 0===t.attrs.type&&(t.attrs.type="text/css"),void 0===t.attrs.nonce){var s=function(){0;return n.nc}();s&&(t.attrs.nonce=s)}return g(e,t.attrs),p(t,e),e}function g(t,e){Object.keys(e).forEach(function(n){t.setAttribute(n,e[n])})}function x(t,e){var n,s,i,o;if(e.transform&&t.css){if(!(o="function"==typeof e.transform?e.transform(t.css):e.transform.default(t.css)))return function(){};t.css=o}if(e.singleton){var r=l++;n=h||(h=w(e)),s=b.bind(null,n,r,!1),i=b.bind(null,n,r,!0)}else t.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(n=function(t){var e=document.createElement("link");return void 0===t.attrs.type&&(t.attrs.type="text/css"),t.attrs.rel="stylesheet",g(e,t.attrs),p(t,e),e}(e),s=function(t,e,n){var s=n.css,i=n.sourceMap,o=void 0===e.convertToAbsoluteUrls&&i;(e.convertToAbsoluteUrls||o)&&(s=f(s));i&&(s+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(i))))+" */");var r=new Blob([s],{type:"text/css"}),a=t.href;t.href=URL.createObjectURL(r),a&&URL.revokeObjectURL(a)}.bind(null,n,e),i=function(){y(n),n.href&&URL.revokeObjectURL(n.href)}):(n=w(e),s=function(t,e){var n=e.css,s=e.media;s&&t.setAttribute("media",s);if(t.styleSheet)t.styleSheet.cssText=n;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(n))}}.bind(null,n),i=function(){y(n)});return s(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;s(t=e)}else i()}}t.exports=function(t,e){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(e=e||{}).attrs="object"==typeof e.attrs?e.attrs:{},e.singleton||"boolean"==typeof e.singleton||(e.singleton=r()),e.insertInto||(e.insertInto="head"),e.insertAt||(e.insertAt="bottom");var n=u(t,e);return d(n,e),function(t){for(var s=[],i=0;i<n.length;i++){var r=n[i];(a=o[r.id]).refs--,s.push(a)}t&&d(u(t,e),e);for(i=0;i<s.length;i++){var a;if(0===(a=s[i]).refs){for(var h=0;h<a.parts.length;h++)a.parts[h]();delete o[a.id]}}}};var m,v=(m=[],function(t,e){return m[t]=e,m.filter(Boolean).join("\n")});function b(t,e,n,s){var i=n?"":s.css;if(t.styleSheet)t.styleSheet.cssText=v(e,i);else{var o=document.createTextNode(i),r=t.childNodes;r[e]&&t.removeChild(r[e]),r.length?t.insertBefore(o,r[e]):t.appendChild(o)}}},function(t,e,n){"use strict";n.r(e),n.d(e,"Base",function(){return E}),n.d(e,"ExtensionManager",function(){return S});var s=n(0),i=n(8),o=n.n(i),r=n(9),a=n.n(r),h=n(10),l=n.n(h),c=n(4),f=n.n(c),d=n(11),u=n.n(d),p=n(7),y=n.n(p),w=n(13),g=n.n(w),x=n(12),m=n.n(x),v=n(17),b=n.n(v),I=n(16),_=n.n(I),k=n(15),M=n.n(k),O=n(5),P=n.n(O),A=n(14),D=n.n(A);n.d(e,"BoxElementGenerator",function(){return o.a}),n.d(e,"GeneratorId",function(){return a.a}),n.d(e,"PositionCounter",function(){return l.a}),n.d(e,"BreakpointAnimation",function(){return f.a}),n.d(e,"ConflictFixer",function(){return u.a});class E{constructor(t){this.etx=t}onConstruct(t){this.etx.components[t.name].push(t)}onDestroy(t){this.etx.components[t.name].splice(this.etx.components[t.name].indexOf(t),1)}}function S({breakpointAnimation:t}={}){this.components={[s.SN.Timeline]:[],[s.SN.Axis]:[],[s.SN.AxisBody]:[],[s.SN.AxisScale]:[],[s.SN.AxisMilestone]:[],[s.SN.Event]:[],[s.SN.EventBody]:[],[s.SN.EventMark]:[],[s.SN.EventAxis]:[]},this.breakpoint=new f.a(this,t),this.extensions=[new E(this),new a.a(this),new l.a(this),new u.a(this),this.breakpoint],s.DEBUG&&this.extensions.push(new o.a(this))}S.prototype.getParent=function(t){if(P.a.is(t))return this.components[s.SN.Timeline][0];if(D.a.is(t))return this.components[s.SN.Timeline][0];if(y.a.is(t))return this.components[s.SN.Axis][0];if(g.a.is(t))return this.components[s.SN.Axis][0];if(m.a.is(t))return this.components[s.SN.Axis][0];if(b.a.is(t))return this.components[s.SN.Event].find(e=>e.body===t);if(_.a.is(t))return this.components[s.SN.Event].find(e=>e.axis===t);if(M.a.is(t))return this.components[s.SN.Event].find(e=>e.mark===t);throw new TypeError(`Cannot find parent of ${t.constructor.name}`)},["onConstruct","onApply","onDestroy","onHide","onDraw"].forEach(t=>{S.prototype[t]=async function(...e){for(const n of this.extensions)t in n&&("onConstruct"===t?n[t](...e):await n[t](...e))}})},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=n(3),i=n(22),o=n(23),r=n(24);e.default=class extends s.Axis{constructor(t){super(t),this.theme="colors",this.bodyConstructor=i.default,this.milestoneConstructor=o.default,this.scaleConstructor=r.default,this.roughCanvas=t.roughCanvas}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=n(3);e.default=class extends s.AxisBody{constructor(t){super(t),this.theme="colors",this.roughCanvas=t.roughCanvas}draw(){const t=this.drawInfo.box;return this.roughCanvas.line(t.x+t.width/2,t.y,t.x+t.width/2,t.y+t.height,{strokeWidth:t.width,stroke:"#333",hachureGap:0,roughness:.2}),super.draw()}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=n(3);e.default=class extends s.AxisMilestone{constructor(t){super(t),this.theme="colors",this.roughCanvas=t.roughCanvas}draw(){const t=this.drawInfo.box;return this.roughCanvas.rectangle(t.x,t.y,t.width,t.height,{stroke:"#333",strokeWidth:1.5,fill:"#fff",fillWeight:.5,fillStyle:"solid",hachureGap:2,roughness:.7,bowing:.5}),super.draw()}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=n(3);e.default=class extends s.AxisScale{constructor(t){super(t),this.theme="colors",this.roughCanvas=t.roughCanvas}draw(){const t=this.drawInfo.box;return this.roughCanvas.rectangle(t.x,t.y,t.width,t.height,{strokeWidth:0,stroke:"rgba(0,0,0,0)",fill:"#fff",fillWeight:.3,fillStyle:"solid",hachureGap:0,roughness:0,bowing:0}),super.draw()}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=n(3),i=n(26),o=n(27),r=n(28);e.default=class extends s.Event{constructor(t){super(t),this.theme="colors",this.bodyConstructor=i.default,this.axisConstructor=o.default,this.markConstructor=r.default,this.roughCanvas=t.roughCanvas}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=n(3),i=n(1);e.default=class extends s.EventBody{constructor(t){super(t),this.theme="colors",this.drawInfo=Object.assign({},this.drawInfo,{mainColor:""}),this.roughCanvas=t.roughCanvas}draw(){const t=i.shrinkBox(this.drawInfo.box,1.5);return this.roughCanvas.rectangle(t.x,t.y,t.width,t.height,{strokeWidth:0,stroke:"rgba(0, 0, 0, 0)",fill:this.drawInfo.mainColor,fillWeight:.5,fillStyle:"solid"}),this.roughCanvas.line(this.drawInfo.markDrawInfo.target.x+2,this.drawInfo.markDrawInfo.target.y,this.drawInfo.box.x+this.drawInfo.box.width-2,this.drawInfo.markDrawInfo.target.y,{strokeWidth:1.5,roughness:1.3,bowing:.5,stroke:this.drawInfo.mainColor}),super.draw()}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=n(3);e.default=class extends s.EventAxis{constructor(t){super(t),this.theme="colors",this.drawInfo=Object.assign({},this.drawInfo,{mainColor:""}),this.roughCanvas=t.roughCanvas}draw(){return this.roughCanvas.linearPath([[this.drawInfo.markDrawInfo.target.x,this.drawInfo.markDrawInfo.target.y],[this.drawInfo.markDrawInfo.target.x+this.drawInfo.offsetX,this.drawInfo.markDrawInfo.target.y],[this.drawInfo.markDrawInfo.target.x+this.drawInfo.offsetX,this.drawInfo.markDrawInfo.target.y-this.drawInfo.length+5]],{strokeWidth:1.5,stroke:this.drawInfo.mainColor,roughness:.7,bowing:0}),this.roughCanvas.circle(this.drawInfo.markDrawInfo.target.x+this.drawInfo.offsetX,this.drawInfo.markDrawInfo.target.y-this.drawInfo.length,10,{strokeWidth:1.5,stroke:this.drawInfo.mainColor,roughness:.2}),super.draw()}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=n(3);e.default=class extends s.EventMark{constructor(t){super(t),this.theme="colors",this.drawInfo=Object.assign({},this.drawInfo,{mainColor:""}),this.roughCanvas=t.roughCanvas}draw(){this.roughCanvas.circle(this.drawInfo.target.x,this.drawInfo.target.y,this.drawInfo.width,{strokeWidth:0,stroke:"rgba(0, 0, 0, 0)",fill:this.drawInfo.mainColor,fillWeight:.5,fillStyle:"solid",roughness:.5})}}},function(t,e,n){"use strict";var s=this&&this.__awaiter||function(t,e,n,s){return new(n||(n=Promise))(function(i,o){function r(t){try{h(s.next(t))}catch(t){o(t)}}function a(t){try{h(s.throw(t))}catch(t){o(t)}}function h(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(r,a)}h((s=s.apply(t,e||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0});const i=n(3);e.default=class{constructor(t){this.etx=t,this.colors=["rgb(213, 57, 38)","rgb(252, 200, 29)","rgb(0, 163, 201)"],this.startIndex=Math.floor(3*Math.random())}onApply(t){return s(this,void 0,void 0,function*(){i.Timeline.is(t)&&this.createColor(t),(i.EventBody.is(t)||i.EventMark.is(t)||i.EventAxis.is(t))&&this.setColorIntoDrawInfo(t)})}onConstruct(t){i.Event.is(t)&&(t.extraData.mainColor="#000")}setColorIntoDrawInfo(t){const e=this.etx;Object.defineProperty(t.drawInfo,"mainColor",{get:()=>e.getParent(t).extraData.mainColor})}createColor(t){for(let e=0;e<t.events.length;e++){const n=(e+this.startIndex)%this.colors.length;t.events[e].extraData.mainColor=this.colors[n]}}}},function(t,e,n){"use strict";var s=this&&this.__awaiter||function(t,e,n,s){return new(n||(n=Promise))(function(i,o){function r(t){try{h(s.next(t))}catch(t){o(t)}}function a(t){try{h(s.throw(t))}catch(t){o(t)}}function h(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(r,a)}h((s=s.apply(t,e||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0});const i=n(31),o=[{date:"2014-5",title:"开始 自学Web开发"},{title:"入学 青岛理工大学",date:"2014-9-1",endDate:"2018-7-29"},{date:"2014-12",title:"青理Web开发协会",text:"创建青理Web开发协会，担当会长",endDate:"2016-6",endText:"协会换届"},{date:"2015-6",title:"注册 青岛卓然独立网络科技有限公司",endDate:"2017-6-19"},{title:"360前端星计划",text:"《360前端星计划》由360前端团队和校园招聘团队合办，面向在校大学生，为培养最优秀最有潜力的前端人才举办的前端技术系列课程",date:"2017-4-9",endDate:"2017-4-14",folded:!0},{title:"Mozilla 实习",date:"2017-7-14",endDate:"2018-2-9"},{title:"百度 KITT.AI 实习",date:"2018-3-21",endDate:"2018-5-28",endText:"Team 被解散"},{title:"KITT.AI 团队 2倍简单奖",date:"2018-6-29"},{title:"百度 SWAN 团队",date:"2018-7-4",endDate:"now"},{title:"Mozilla 实习 123",date:"2017-9-10"},{title:"Mozilla 实习 233",date:"2017-8-10"},{title:"2015-7-25",date:"2015-7-25"},{title:"2015-1",date:"2015-1"},{title:"2015-5",date:"2015-5-1"}];document.addEventListener("DOMContentLoaded",()=>s(this,void 0,void 0,function*(){const t=yield i.draw("#app",o);yield new Promise(t=>setTimeout(t,500)),t.hide();const e=yield i.drawWithAnimation("#app",o);yield new Promise(t=>setTimeout(t,500)),e.hide(),yield i.drawFrom("#app",t.export())}))},function(t,e,n){"use strict";var s=this&&this.__awaiter||function(t,e,n,s){return new(n||(n=Promise))(function(i,o){function r(t){try{h(s.next(t))}catch(t){o(t)}}function a(t){try{h(s.throw(t))}catch(t){o(t)}}function h(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(r,a)}h((s=s.apply(t,e||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0});const i=n(32);function o(t){const e="string"==typeof t?document.querySelector(t):t;e.innerHTML="",e.classList.add("short-night","colors","container");const n=document.createElement("canvas");return e.classList.add("short-night","colors","canvas"),e.appendChild(n),{container:e,canvas:n}}e.draw=function(t,e){return s(this,void 0,void 0,function*(){const{container:n,canvas:s}=o(t),r=new i.Timeline({canvas:s,container:n,ext:new i.ExtensionManager});return r.drawInfo.events=e,yield r.apply(),r.draw(),r})},e.drawWithAnimation=function(t,e){return s(this,void 0,void 0,function*(){const{container:n,canvas:s}=o(t),r=new i.Timeline({canvas:s,container:n,ext:new i.ExtensionManager({breakpointAnimation:{playAnimation:!0}})});return r.drawInfo.events=e,yield r.apply(),r.draw(),r})},e.drawFrom=function(t,e){return s(this,void 0,void 0,function*(){const{container:n,canvas:s}=o(t),r=new i.Timeline({canvas:s,container:n,ext:new i.ExtensionManager({breakpointAnimation:{playAnimation:!0}})});return yield r.drawFrom(e),r})}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),console.log("おつ colors!"),n(33);var s=n(36);e.Timeline=s.default;var i=n(21);e.Axis=i.default;var o=n(24);e.AxisScale=o.default;var r=n(23);e.AxisMilestone=r.default;var a=n(22);e.AxisBody=a.default;var h=n(25);e.Event=h.default;var l=n(28);e.EventMark=l.default;var c=n(27);e.EventAxis=c.default;var f=n(26);e.EventBody=f.default;var d=n(2);e.Component=d.default;var u=n(29);e.ColorPicker=u.default;var p=n(20);e.ExtensionManager=p.ExtensionManager,e.BoxElementGenerator=p.BoxElementGenerator,e.GeneratorId=p.GeneratorId,e.PositionCounter=p.PositionCounter,e.BreakpointAnimation=p.BreakpointAnimation,e.ConflictFixer=p.ConflictFixer},function(t,e,n){var s=n(34);"string"==typeof s&&(s=[[t.i,s,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};n(19)(s,i);s.locals&&(t.exports=s.locals)},function(t,e,n){(t.exports=n(18)(!1)).push([t.i,".short-night.colors.axis_milestone {\n  font-size: 18px;\n  color: #333;\n  padding: 2px 7px; }\n\n.short-night.colors.event_body {\n  color: #fff;\n  padding: 7px 10px 7px 5px;\n  text-align: right; }\n  .short-night.colors.event_body .folded {\n    cursor: pointer; }\n    .short-night.colors.event_body .folded .title, .short-night.colors.event_body .folded .foldedText {\n      overflow: hidden;\n      text-overflow: ellipsis;\n      white-space: nowrap; }\n  .short-night.colors.event_body .title, .short-night.colors.event_body .foldedText {\n    font-size: 1em;\n    padding-left: 10px; }\n  .short-night.colors.event_body .date {\n    font-size: 0.6em;\n    font-weight: normal;\n    font-style: italic; }\n\n.short-night.colors.event_axis-endText {\n  padding: 0 0 2px 3px;\n  font-size: 0.8em; }\n",""])},function(t,e){t.exports=function(t){var e="undefined"!=typeof window&&window.location;if(!e)throw new Error("fixUrls requires window.location");if(!t||"string"!=typeof t)return t;var n=e.protocol+"//"+e.host,s=n+e.pathname.replace(/\/[^\/]*$/,"/");return t.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,function(t,e){var i,o=e.trim().replace(/^"(.*)"$/,function(t,e){return e}).replace(/^'(.*)'$/,function(t,e){return e});return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(o)?t:(i=0===o.indexOf("//")?o:0===o.indexOf("/")?n+o:s+o.replace(/^\.\//,""),"url("+JSON.stringify(i)+")")})}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=n(45),i=n(3),o=n(21),r=n(25),a=n(29);e.default=class extends i.Timeline{constructor(t){super(t),this.theme="colors",this.grid=Object.assign({},i.Timeline.defaultGrid,{scaleHeight:3,axisWidth:5,markWidth:10}),this.axisConstructor=o.default,this.eventConstructor=r.default,this.ext.extensions.push(new a.default(t.ext)),this.roughCanvas=s.default.canvas(this.canvas)}}},function(t,e,n){var s=n(38);"string"==typeof s&&(s=[[t.i,s,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};n(19)(s,i);s.locals&&(t.exports=s.locals)},function(t,e,n){(t.exports=n(18)(!1)).push([t.i,".short-night {\n  position: relative;\n  box-sizing: border-box; }\n  .short-night {\n    margin: 0;\n    padding: 0; }\n  .short-night.axis_milestone {\n    font-family: sans-serif;\n    position: absolute;\n    padding: 5px 10px; }\n  .short-night.event_body {\n    position: absolute;\n    color: #000;\n    padding: 7px 10px 7px 5px;\n    text-align: right; }\n    .short-night.event_body.folded {\n      cursor: pointer; }\n      .short-night.event_body.folded .title, .short-night.event_body.folded .foldedText {\n        overflow: hidden;\n        text-overflow: ellipsis;\n        white-space: nowrap; }\n    .short-night.event_body .title, .short-night.event_body .foldedText {\n      font-size: 1em;\n      padding-left: 10px; }\n    .short-night.event_body .date {\n      font-size: 0.6em;\n      font-weight: normal;\n      font-style: italic; }\n  .short-night.event_axis-endText {\n    position: absolute;\n    padding: 0 0 2px 3px;\n    font-size: 0.8em;\n    text-indent: 0.5em; }\n",""])},function(t){t.exports={name:"short-night",version:"0.0.1",description:"",main:"index.js",scripts:{"fix-lint":"eslint src/**/*.js --fix && tslint --project tsconfig.json --fix",eslint:"eslint src/**/*.js",tslint:"tslint --project tsconfig.json",build:"cross-env NODE_ENV=production webpack --mode production",test:"npm run eslint && npm run tslint && tsc",dev:"webpack --mode development --watch"},repository:{type:"git",url:"git+https://github.com/pea3nut/short-night.git"},keywords:["timeline"],author:"pea3nut",license:"MIT",bugs:{url:"https://github.com/pea3nut/short-night/issues"},homepage:"https://github.com/pea3nut/short-night#readme",devDependencies:{"@types/moveto":"^1.7.0","cross-env":"^5.2.0","css-loader":"^1.0.0",eslint:"^5.10.0","eslint-config-airbnb-base":"^13.1.0","eslint-import-resolver-alias":"^1.1.2","eslint-loader":"^2.1.1","eslint-plugin-import":"^2.14.0","node-sass":"^4.9.3","sass-loader":"^7.1.0","style-loader":"^0.23.0","ts-loader":"^4.4.2",tslint:"^5.11.0","tslint-config-airbnb":"^5.11.1","tslint-loader":"^3.5.4","tslint-webpack-plugin":"^1.3.0",typescript:"^2.9.2",webpack:"^4.16.0","webpack-cli":"^3.0.8"},dependencies:{moveto:"^1.7.4",roughjs:"^2.2.5"}}},function(t,e,n){"use strict";
/*!
 * MoveTo - A lightweight scroll animation javascript library without any dependency.
 * Version 1.7.4 (28-09-2018 16:02)
 * Licensed under MIT
 * Copyright 2018 Hasan Aydoğdu <hsnaydd@gmail.com>
 */var s=function(){var t={tolerance:0,duration:800,easing:"easeOutQuart",callback:function(){}};function e(t,e,n,s){return t/=s,-n*(--t*t*t*t-1)+e}function n(t,e){var n={};return Object.keys(t).forEach(function(e){n[e]=t[e]}),Object.keys(e).forEach(function(t){n[t]=e[t]}),n}function s(){var s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.options=n(t,s),this.easeFunctions=n({easeOutQuart:e},i)}return s.prototype.registerTrigger=function(t,e){var s=this;if(t){var i=t.getAttribute("href")||t.getAttribute("data-target"),o=i&&"#"!==i?document.getElementById(i.substring(1)):document.body,r=n(this.options,function(t,e){var n={};return Object.keys(e).forEach(function(e){var s=t.getAttribute("data-mt-"+e.replace(/([A-Z])/g,function(t){return"-"+t.toLowerCase()}));s&&(n[e]=isNaN(s)?s:parseInt(s,10))}),n}(t,this.options));"function"==typeof e&&(r.callback=e);var a=function(t){t.preventDefault(),s.move(o,r)};return t.addEventListener("click",a,!1),function(){return t.removeEventListener("click",a,!1)}}},s.prototype.move=function(t){var e=this,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(0===t||t){s=n(this.options,s);var i="number"==typeof t?t:t.getBoundingClientRect().top,o=window.pageYOffset,r=null,a=void 0;i-=s.tolerance;window.requestAnimationFrame(function n(h){var l=window.pageYOffset;r||(r=h-1);var c=h-r;if(a&&(i>0&&a>l||i<0&&a<l))return s.callback(t);a=l;var f=e.easeFunctions[s.easing](c,o,i,s.duration);window.scroll(0,f),c<s.duration?window.requestAnimationFrame(n):(window.scroll(0,i+o),s.callback(t))})}},s.prototype.addEaseFunction=function(t,e){this.easeFunctions[t]=e},s}();t.exports=s},function(t,e,n){"use strict";var s=this&&this.__awaiter||function(t,e,n,s){return new(n||(n=Promise))(function(i,o){function r(t){try{h(s.next(t))}catch(t){o(t)}}function a(t){try{h(s.throw(t))}catch(t){o(t)}}function h(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(r,a)}h((s=s.apply(t,e||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0});const i=n(0),o=n(1),r=n(4);e.default=class{constructor(t){this.ext=t}fix(){return s(this,void 0,void 0,function*(){const t=this.ext.components[i.SN.EventBody],e=this.ext.components[i.SN.AxisMilestone];for(const n of t)for(const t of e)if(o.isOverlap(n.drawInfo.box,t.drawInfo.box)){const e={protagonist:t,components:[...this.ext.components[i.SN.AxisBody],t,n]};yield this.ext.breakpoint.block(r.Breakpoint.FixEventBody2AxisMilestone,e),n.drawInfo.offset.x=t.drawInfo.box.width/2+1,yield n.apply(),yield this.ext.breakpoint.block(r.Breakpoint.FixEventBody2AxisMilestone,Object.assign({},e,{forward:!0}))}return"no-conflict"})}}},function(t,e,n){"use strict";var s=this&&this.__awaiter||function(t,e,n,s){return new(n||(n=Promise))(function(i,o){function r(t){try{h(s.next(t))}catch(t){o(t)}}function a(t){try{h(s.throw(t))}catch(t){o(t)}}function h(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(r,a)}h((s=s.apply(t,e||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0});const i=n(0),o=n(1),r=n(4);class a{constructor(t){this.ext=t}fix(){return s(this,void 0,void 0,function*(){const t=Array.from(this.ext.components[i.SN.EventAxis]).sort((t,e)=>e.drawInfo.length-t.drawInfo.length);for(;t.some(e=>t.some(t=>a.isConflict(e,t)));)for(const e of t){const n=t.filter(t=>a.isConflict(e,t));if(n.length){const t={protagonist:e,components:[...this.ext.components[i.SN.AxisBody],this.ext.getParent(e),...n.map(t=>this.ext.getParent(t))]};yield this.ext.breakpoint.block(r.Breakpoint.FixEventAxis2EventAxis,t),e.drawInfo.offsetX+=15,yield e.apply(),yield this.ext.breakpoint.block(r.Breakpoint.FixEventAxis2EventAxis,Object.assign({},t,{forward:!0}));break}}return"no-conflict"})}static isConflict(t,e){if(t===e)return!1;const n={startX:t.drawInfo.markDrawInfo.target.x+t.drawInfo.offsetX,startY:t.drawInfo.markDrawInfo.target.y,endX:t.drawInfo.markDrawInfo.target.x+t.drawInfo.offsetX,endY:t.drawInfo.markDrawInfo.target.y-t.drawInfo.length},s={startX:e.drawInfo.markDrawInfo.target.x+e.drawInfo.offsetX,startY:e.drawInfo.markDrawInfo.target.y,endX:e.drawInfo.markDrawInfo.target.x+e.drawInfo.offsetX,endY:e.drawInfo.markDrawInfo.target.y-e.drawInfo.length};return o.isIntersecting(n,s)}}e.default=a},function(t,e,n){"use strict";var s=this&&this.__awaiter||function(t,e,n,s){return new(n||(n=Promise))(function(i,o){function r(t){try{h(s.next(t))}catch(t){o(t)}}function a(t){try{h(s.throw(t))}catch(t){o(t)}}function h(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(r,a)}h((s=s.apply(t,e||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0});const i=n(1),o=n(0),r=n(4);class a{constructor(t){this.ext=t,this.conflicts=[],this.eventBodyList=[],this.spaceMap=new Map}static avoid({mover:t,fixed:e,direction:n}){return s(this,void 0,void 0,function*(){n>0?t.drawInfo.offset.y+=e.drawInfo.box.y+e.drawInfo.box.height-t.drawInfo.box.y+1:t.drawInfo.offset.y-=t.drawInfo.box.y+t.drawInfo.box.height-e.drawInfo.box.y+1,yield t.apply()})}static isConflict(t,e){if(t===e)return!1;if(t.drawInfo.floated!==e.drawInfo.floated){const n=t.drawInfo.floated?t:e,s=t===n?e:t;if(n.drawInfo.markDrawInfo.target.y>s.drawInfo.box.y&&n.drawInfo.markDrawInfo.target.y<s.drawInfo.box.y+s.drawInfo.box.height)return!0}return i.isOverlap(t.drawInfo.box,e.drawInfo.box)}fix(){return s(this,void 0,void 0,function*(){return this.eventBodyList=Array.from(this.ext.components[o.SN.EventBody]).sort((t,e)=>t.drawInfo.markDrawInfo.target.y-e.drawInfo.markDrawInfo.target.y),yield i.walkLoop(()=>s(this,void 0,void 0,function*(){return[yield this.tryFixOne()]}))})}tryFixOne(){return s(this,void 0,void 0,function*(){if(yield this.countConflict(),this.countSpace(),0===this.conflicts.length)return"no-conflict";if(this.conflicts=this.conflicts.filter(t=>this.isPossible(t)),0===this.conflicts.length)return"failed";const t=this.conflicts.find(t=>this.conflicts.every(e=>this.countCast(t)<=this.countCast(e))),e={components:[...this.ext.components[o.SN.AxisBody],t.self,...t.with],protagonist:t.self};return yield this.ext.breakpoint.block(r.Breakpoint.FixEventBody2EventBodyMover,e),yield this.fixConflict(t),yield this.ext.breakpoint.block(r.Breakpoint.FixEventBody2EventBodyMover,Object.assign({},e,{forward:!0})),"alleviated"})}isPossible(t){if(t.self.drawInfo.floated&&t.with.some(t=>!t.drawInfo.floated))return!1;const e=this.countNeeded(t),n=this.spaceMap.get(t.self);return(0===e.bottom||0===e.top)&&n.bottom>=e.bottom&&n.top>=e.top}fixConflict(t){return s(this,void 0,void 0,function*(){const e=this.countNeeded(t),n=e.top?e.top:-e.bottom,s=n/Math.abs(n);t.self.drawInfo.offset.y+=n,yield t.self.apply();const i=this.eventBodyList.filter(e=>e.drawInfo.floated===t.self.drawInfo.floated);for(let e=i.indexOf(t.self)+s;e>=0&&e<i.length;e+=s){const t=i[e-s],n=i[e];if(!a.isConflict(t,n))break;yield a.avoid({direction:s,mover:n,fixed:t})}})}countConflict(){return s(this,void 0,void 0,function*(){this.conflicts.length=0,yield Promise.all(this.eventBodyList.map(t=>t.apply()));for(const t of this.eventBodyList){const e={self:t,with:this.eventBodyList.filter(e=>a.isConflict(t,e))};e.with.length&&this.conflicts.push(e)}})}countCast(t){const e=this.countNeeded(t);return e.bottom+e.top}countNeeded(t){const e=t.self,n={top:0,bottom:0},s=t.with.filter(t=>t.drawInfo.markDrawInfo.target.y<e.drawInfo.markDrawInfo.target.y),i=t.with.filter(t=>t.drawInfo.markDrawInfo.target.y>e.drawInfo.markDrawInfo.target.y);return s.length&&(n.top=Math.max(...s.map(t=>{if(t.drawInfo.floated===e.drawInfo.floated)return t.drawInfo.box.y+t.drawInfo.box.height-e.drawInfo.box.y;if(e.drawInfo.floated)return t.drawInfo.box.y+t.drawInfo.box.height-e.drawInfo.markDrawInfo.target.y;if(t.drawInfo.floated)return t.drawInfo.markDrawInfo.target.y-e.drawInfo.box.y;throw SyntaxError("floated is not a boolean")}))),i.length&&(n.bottom=Math.max(...i.map(t=>{if(t.drawInfo.floated===e.drawInfo.floated)return e.drawInfo.box.y+e.drawInfo.box.height-t.drawInfo.box.y;if(e.drawInfo.floated)return e.drawInfo.markDrawInfo.target.y-t.drawInfo.box.y;if(t.drawInfo.floated)return e.drawInfo.box.y+e.drawInfo.box.height-t.drawInfo.markDrawInfo.target.y;throw SyntaxError("floated is not a boolean")}))),n.top&&n.top++,n.bottom&&n.bottom++,e.extraData.needed=n,n}countSpace(){this.eventBodyList.forEach(t=>this.spaceMap.set(t,{top:t.drawInfo.markDrawInfo.target.y-t.drawInfo.box.y-4,bottom:t.drawInfo.box.y+t.drawInfo.box.height-t.drawInfo.markDrawInfo.target.y-4}));const t=t=>{if(0===t.length)return;const e=t[0];this.spaceMap.get(e).bottom=Math.min(this.spaceMap.get(e).bottom,e.drawInfo.box.y);const n=t[t.length-1];this.spaceMap.get(n).top=Math.min(this.spaceMap.get(n).top,n.canvas.height-(n.drawInfo.box.y+n.drawInfo.box.height));for(let e=1;e<t.length;e++){const n=t[e-1],s=t[e],i=this.spaceMap.get(s),o=this.spaceMap.get(n),r=s.drawInfo.box.y-(n.drawInfo.box.y+n.drawInfo.box.height);i.bottom=Math.min(i.bottom,r+o.bottom)}for(let e=t.length-2;e>=0;e--){const n=t[e+1],s=t[e],i=this.spaceMap.get(s),o=this.spaceMap.get(n),r=n.drawInfo.box.y-(s.drawInfo.box.y+s.drawInfo.box.height);i.top=Math.min(i.top,r+o.top)}Array.from(this.spaceMap.values()).forEach(t=>{t.top=Math.max(0,t.top),t.bottom=Math.max(0,t.bottom)})};t(this.eventBodyList.filter(t=>t.drawInfo.floated)),t(this.eventBodyList.filter(t=>!t.drawInfo.floated)),this.eventBodyList.forEach(t=>t.extraData.space=this.spaceMap.get(t))}}e.default=a},function(t,e,n){"use strict";var s=this&&this.__awaiter||function(t,e,n,s){return new(n||(n=Promise))(function(i,o){function r(t){try{h(s.next(t))}catch(t){o(t)}}function a(t){try{h(s.throw(t))}catch(t){o(t)}}function h(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(r,a)}h((s=s.apply(t,e||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0});const i=n(0),o=n(1),r=n(4);class a{constructor(t){this.ext=t,this.conflicts=[],this.eventBodyList=[]}static isConflict(t,e){return t!==e&&(!t.drawInfo.floated&&!e.drawInfo.floated&&o.isOverlap(t.drawInfo.box,e.drawInfo.box))}float(t){return s(this,void 0,void 0,function*(){const e=Math.max(...t.with.map(t=>t.drawInfo.box.width+t.drawInfo.offset.x));t.self.drawInfo.offset.x=e+1,t.self.drawInfo.maxWidth=Math.min(this.timeline.grid.eventWidth,this.axisBody.drawInfo.box.x-e),t.self.drawInfo.floated=!0,yield t.self.apply()})}fix(){return s(this,void 0,void 0,function*(){if(this.timeline=this.ext.components[i.SN.Timeline][0],this.axisBody=this.ext.components[i.SN.AxisBody][0],this.eventBodyList=Array.from(this.ext.components[i.SN.EventBody]).sort((t,e)=>t.drawInfo.markDrawInfo.target.y-e.drawInfo.markDrawInfo.target.y),this.countConflict(),0===this.conflicts.length)return"no-conflict";const t=this.pickRingleader(),e={components:[this.axisBody,t.self,...t.with],protagonist:t.self};return yield this.ext.breakpoint.block(r.Breakpoint.FixEventBody2EventBodyFloater,e),yield this.float(t),yield this.ext.breakpoint.block(r.Breakpoint.FixEventBody2EventBodyFloater,Object.assign({},e,{forward:!0})),"alleviated"})}pickRingleader(){return this.conflicts.find(t=>this.conflicts.every(e=>t.with.length>=e.with.length))}countConflict(){this.conflicts.length=0;for(const t of this.eventBodyList){const e={self:t,with:this.ext.components[i.SN.EventBody].filter(e=>a.isConflict(t,e))};e.with.length&&this.conflicts.push(e)}}}e.default=a},function(t,e,n){"use strict";function s(t,e){return t.type===e}n.r(e);const i={A:7,a:7,C:6,c:6,H:1,h:1,L:2,l:2,M:2,m:2,Q:4,q:4,S:4,s:4,T:4,t:2,V:1,v:1,Z:0,z:0};class o{constructor(t){this.COMMAND=0,this.NUMBER=1,this.EOD=2,this.segments=[],this.parseData(t),this.processPoints()}tokenize(t){const e=new Array;for(;""!==t;)if(t.match(/^([ \t\r\n,]+)/))t=t.substr(RegExp.$1.length);else if(t.match(/^([aAcChHlLmMqQsStTvVzZ])/))e[e.length]={type:this.COMMAND,text:RegExp.$1},t=t.substr(RegExp.$1.length);else{if(!t.match(/^(([-+]?[0-9]+(\.[0-9]*)?|[-+]?\.[0-9]+)([eE][-+]?[0-9]+)?)/))return console.error("Unrecognized segment command: "+t),[];e[e.length]={type:this.NUMBER,text:`${parseFloat(RegExp.$1)}`},t=t.substr(RegExp.$1.length)}return e[e.length]={type:this.EOD,text:""},e}parseData(t){const e=this.tokenize(t);let n=0,o=e[n],r="BOD";for(this.segments=new Array;!s(o,this.EOD);){let a;const h=new Array;if("BOD"===r){if("M"!==o.text&&"m"!==o.text)return void this.parseData("M0,0"+t);n++,a=i[o.text],r=o.text}else s(o,this.NUMBER)?a=i[r]:(n++,a=i[o.text],r=o.text);if(n+a<e.length){for(let t=n;t<n+a;t++){const n=e[t];if(!s(n,this.NUMBER))return void console.error("Parameter type is not a number: "+r+","+n.text);h[h.length]=+n.text}if("number"!=typeof i[r])return void console.error("Unsupported segment type: "+r);{const t={key:r,data:h};this.segments.push(t),o=e[n+=a],"M"===r&&(r="L"),"m"===r&&(r="l")}}else console.error("Path data ended before all parameters were found")}}get closed(){if(void 0===this._closed){this._closed=!1;for(const t of this.segments)"z"===t.key.toLowerCase()&&(this._closed=!0)}return this._closed}processPoints(){let t=null,e=[0,0];for(let n=0;n<this.segments.length;n++){const s=this.segments[n];switch(s.key){case"M":case"L":case"T":s.point=[s.data[0],s.data[1]];break;case"m":case"l":case"t":s.point=[s.data[0]+e[0],s.data[1]+e[1]];break;case"H":s.point=[s.data[0],e[1]];break;case"h":s.point=[s.data[0]+e[0],e[1]];break;case"V":s.point=[e[0],s.data[0]];break;case"v":s.point=[e[0],s.data[0]+e[1]];break;case"z":case"Z":t&&(s.point=[t[0],t[1]]);break;case"C":s.point=[s.data[4],s.data[5]];break;case"c":s.point=[s.data[4]+e[0],s.data[5]+e[1]];break;case"S":s.point=[s.data[2],s.data[3]];break;case"s":s.point=[s.data[2]+e[0],s.data[3]+e[1]];break;case"Q":s.point=[s.data[2],s.data[3]];break;case"q":s.point=[s.data[2]+e[0],s.data[3]+e[1]];break;case"A":s.point=[s.data[5],s.data[6]];break;case"a":s.point=[s.data[5]+e[0],s.data[6]+e[1]]}"m"!==s.key&&"M"!==s.key||(t=null),s.point&&(e=s.point,t||(t=s.point)),"z"!==s.key&&"Z"!==s.key||(t=null)}}}class r{constructor(t){this._position=[0,0],this._first=null,this.bezierReflectionPoint=null,this.quadReflectionPoint=null,this.parsed=new o(t)}get segments(){return this.parsed.segments}get closed(){return this.parsed.closed}get linearPoints(){if(!this._linearPoints){const t=[];let e=[];for(const n of this.parsed.segments){const s=n.key.toLowerCase();("m"!==s&&"z"!==s||(e.length&&(t.push(e),e=[]),"z"!==s))&&(n.point&&e.push(n.point))}e.length&&(t.push(e),e=[]),this._linearPoints=t}return this._linearPoints}get first(){return this._first}set first(t){this._first=t}setPosition(t,e){this._position=[t,e],this._first||(this._first=[t,e])}get position(){return this._position}get x(){return this._position[0]}get y(){return this._position[1]}}class a{constructor(t,e,n,s,i,o){if(this._segIndex=0,this._numSegs=0,this._rx=0,this._ry=0,this._sinPhi=0,this._cosPhi=0,this._C=[0,0],this._theta=0,this._delta=0,this._T=0,this._from=t,t[0]===e[0]&&t[1]===e[1])return;const r=Math.PI/180;this._rx=Math.abs(n[0]),this._ry=Math.abs(n[1]),this._sinPhi=Math.sin(s*r),this._cosPhi=Math.cos(s*r);const a=this._cosPhi*(t[0]-e[0])/2+this._sinPhi*(t[1]-e[1])/2,h=-this._sinPhi*(t[0]-e[0])/2+this._cosPhi*(t[1]-e[1])/2;let l=0;const c=this._rx*this._rx*this._ry*this._ry-this._rx*this._rx*h*h-this._ry*this._ry*a*a;if(c<0){const t=Math.sqrt(1-c/(this._rx*this._rx*this._ry*this._ry));this._rx=this._rx*t,this._ry=this._ry*t,l=0}else l=(i===o?-1:1)*Math.sqrt(c/(this._rx*this._rx*h*h+this._ry*this._ry*a*a));const f=l*this._rx*h/this._ry,d=-l*this._ry*a/this._rx;this._C=[0,0],this._C[0]=this._cosPhi*f-this._sinPhi*d+(t[0]+e[0])/2,this._C[1]=this._sinPhi*f+this._cosPhi*d+(t[1]+e[1])/2,this._theta=this.calculateVectorAngle(1,0,(a-f)/this._rx,(h-d)/this._ry);let u=this.calculateVectorAngle((a-f)/this._rx,(h-d)/this._ry,(-a-f)/this._rx,(-h-d)/this._ry);!o&&u>0?u-=2*Math.PI:o&&u<0&&(u+=2*Math.PI),this._numSegs=Math.ceil(Math.abs(u/(Math.PI/2))),this._delta=u/this._numSegs,this._T=8/3*Math.sin(this._delta/4)*Math.sin(this._delta/4)/Math.sin(this._delta/2)}getNextSegment(){if(this._segIndex===this._numSegs)return null;const t=Math.cos(this._theta),e=Math.sin(this._theta),n=this._theta+this._delta,s=Math.cos(n),i=Math.sin(n),o=[this._cosPhi*this._rx*s-this._sinPhi*this._ry*i+this._C[0],this._sinPhi*this._rx*s+this._cosPhi*this._ry*i+this._C[1]],r=[this._from[0]+this._T*(-this._cosPhi*this._rx*e-this._sinPhi*this._ry*t),this._from[1]+this._T*(-this._sinPhi*this._rx*e+this._cosPhi*this._ry*t)],a=[o[0]+this._T*(this._cosPhi*this._rx*i+this._sinPhi*this._ry*s),o[1]+this._T*(this._sinPhi*this._rx*i-this._cosPhi*this._ry*s)];return this._theta=n,this._from=[o[0],o[1]],this._segIndex++,{cp1:r,cp2:a,to:o}}calculateVectorAngle(t,e,n,s){const i=Math.atan2(e,t),o=Math.atan2(s,n);return o>=i?o-i:2*Math.PI-(i-o)}}class h{constructor(t,e){this.sets=t,this.closed=e}fit(t){const e=[];for(const n of this.sets){const s=n.length;let i=Math.floor(t*s);if(i<5){if(s<=5)continue;i=5}e.push(this.reduce(n,i))}let n="";for(const t of e){for(let e=0;e<t.length;e++){const s=t[e];n+=0===e?"M"+s[0]+","+s[1]:"L"+s[0]+","+s[1]}this.closed&&(n+="z ")}return n}distance(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2))}reduce(t,e){if(t.length<=e)return t;const n=t.slice(0);for(;n.length>e;){const t=[];let e=-1,s=-1;for(let i=1;i<n.length-1;i++){const o=this.distance(n[i-1],n[i]),r=this.distance(n[i],n[i+1]),a=this.distance(n[i-1],n[i+1]),h=(o+r+a)/2,l=Math.sqrt(h*(h-o)*(h-r)*(h-a));t.push(l),(e<0||l<e)&&(e=l,s=i)}if(!(s>0))break;n.splice(s,1)}return n}}class l{constructor(t,e){this.xi=Number.MAX_VALUE,this.yi=Number.MAX_VALUE,this.px1=t[0],this.py1=t[1],this.px2=e[0],this.py2=e[1],this.a=this.py2-this.py1,this.b=this.px1-this.px2,this.c=this.px2*this.py1-this.px1*this.py2,this._undefined=0===this.a&&0===this.b&&0===this.c}isUndefined(){return this._undefined}intersects(t){if(this.isUndefined()||t.isUndefined())return!1;let e=Number.MAX_VALUE,n=Number.MAX_VALUE,s=0,i=0;const o=this.a,r=this.b,a=this.c;return Math.abs(r)>1e-5&&(e=-o/r,s=-a/r),Math.abs(t.b)>1e-5&&(n=-t.a/t.b,i=-t.c/t.b),e===Number.MAX_VALUE?n===Number.MAX_VALUE?-a/o==-t.c/t.a&&(this.py1>=Math.min(t.py1,t.py2)&&this.py1<=Math.max(t.py1,t.py2)?(this.xi=this.px1,this.yi=this.py1,!0):this.py2>=Math.min(t.py1,t.py2)&&this.py2<=Math.max(t.py1,t.py2)&&(this.xi=this.px2,this.yi=this.py2,!0)):(this.xi=this.px1,this.yi=n*this.xi+i,!((this.py1-this.yi)*(this.yi-this.py2)<-1e-5||(t.py1-this.yi)*(this.yi-t.py2)<-1e-5)&&(!(Math.abs(t.a)<1e-5)||!((t.px1-this.xi)*(this.xi-t.px2)<-1e-5))):n===Number.MAX_VALUE?(this.xi=t.px1,this.yi=e*this.xi+s,!((t.py1-this.yi)*(this.yi-t.py2)<-1e-5||(this.py1-this.yi)*(this.yi-this.py2)<-1e-5)&&(!(Math.abs(o)<1e-5)||!((this.px1-this.xi)*(this.xi-this.px2)<-1e-5))):e===n?s===i&&(this.px1>=Math.min(t.px1,t.px2)&&this.px1<=Math.max(t.py1,t.py2)?(this.xi=this.px1,this.yi=this.py1,!0):this.px2>=Math.min(t.px1,t.px2)&&this.px2<=Math.max(t.px1,t.px2)&&(this.xi=this.px2,this.yi=this.py2,!0)):(this.xi=(i-s)/(e-n),this.yi=e*this.xi+s,!((this.px1-this.xi)*(this.xi-this.px2)<-1e-5||(t.px1-this.xi)*(this.xi-t.px2)<-1e-5))}}class c{constructor(t,e,n,s,i,o,r,a){this.deltaX=0,this.hGap=0,this.top=t,this.bottom=e,this.left=n,this.right=s,this.gap=i,this.sinAngle=o,this.tanAngle=a,Math.abs(o)<1e-4?this.pos=n+i:Math.abs(o)>.9999?this.pos=t+i:(this.deltaX=(e-t)*Math.abs(a),this.pos=n-Math.abs(this.deltaX),this.hGap=Math.abs(i/r),this.sLeft=new l([n,e],[n,t]),this.sRight=new l([s,e],[s,t]))}nextLine(){if(Math.abs(this.sinAngle)<1e-4){if(this.pos<this.right){const t=[this.pos,this.top,this.pos,this.bottom];return this.pos+=this.gap,t}}else if(Math.abs(this.sinAngle)>.9999){if(this.pos<this.bottom){const t=[this.left,this.pos,this.right,this.pos];return this.pos+=this.gap,t}}else{let t=this.pos-this.deltaX/2,e=this.pos+this.deltaX/2,n=this.bottom,s=this.top;if(this.pos<this.right+this.deltaX){for(;t<this.left&&e<this.left||t>this.right&&e>this.right;)if(this.pos+=this.hGap,t=this.pos-this.deltaX/2,e=this.pos+this.deltaX/2,this.pos>this.right+this.deltaX)return null;const i=new l([t,n],[e,s]);this.sLeft&&i.intersects(this.sLeft)&&(t=i.xi,n=i.yi),this.sRight&&i.intersects(this.sRight)&&(e=i.xi,s=i.yi),this.tanAngle>0&&(t=this.right-(t-this.left),e=this.right-(e-this.left));const o=[t,n,e,s];return this.pos+=this.hGap,o}}return null}}function f(t){const e=t[0],n=t[1];return Math.sqrt(Math.pow(e[0]-n[0],2)+Math.pow(e[1]-n[1],2))}function d(t,e){const n=[],s=new l([t[0],t[1]],[t[2],t[3]]);for(let t=0;t<e.length;t++){const i=new l(e[t],e[(t+1)%e.length]);s.intersects(i)&&n.push([s.xi,s.yi])}return n}function u(t,e,n,s,i,o,r){return[-n*o-s*i+n+o*t+i*e,r*(n*i-s*o)+s+-r*i*t+r*o*e]}function p(t,e){const n=[];if(t&&t.length){let s=t[0][0],i=t[0][0],o=t[0][1],r=t[0][1];for(let e=1;e<t.length;e++)s=Math.min(s,t[e][0]),i=Math.max(i,t[e][0]),o=Math.min(o,t[e][1]),r=Math.max(r,t[e][1]);const a=e.hachureAngle;let h=e.hachureGap;h<0&&(h=4*e.strokeWidth),h=Math.max(h,.1);const l=a%180*(Math.PI/180),f=Math.cos(l),u=Math.sin(l),p=Math.tan(l),y=new c(o-1,r+1,s-1,i+1,h,u,f,p);let w;for(;null!=(w=y.nextLine());){const e=d(w,t);for(let t=0;t<e.length;t++)if(t<e.length-1){const s=e[t],i=e[t+1];n.push([s,i])}}}return n}function y(t,e,n,s,i,o){const r=[];let a=Math.abs(n/2),h=Math.abs(s/2);a+=o.getOffset(.05*-a,.05*a,i),h+=o.getOffset(.05*-h,.05*h,i);const l=i.hachureAngle;let c=i.hachureGap;c<=0&&(c=4*i.strokeWidth);let f=i.fillWeight;f<0&&(f=i.strokeWidth/2);const d=l%180*(Math.PI/180),p=Math.tan(d),y=h/a,w=Math.sqrt(y*p*y*p+1),g=y*p/w,x=1/w,m=c/(a*h/Math.sqrt(h*x*(h*x)+a*g*(a*g))/a);let v=Math.sqrt(a*a-(t-a+m)*(t-a+m));for(let n=t-a+m;n<t+a;n+=m){const s=u(n,e-(v=Math.sqrt(a*a-(t-n)*(t-n))),t,e,g,x,y),i=u(n,e+v,t,e,g,x,y);r.push([s,i])}return r}class w{constructor(t){this.renderer=t}fillPolygon(t,e){return this._fillPolygon(t,e)}fillEllipse(t,e,n,s,i){return this._fillEllipse(t,e,n,s,i)}_fillPolygon(t,e,n=!1){const s=p(t,e);return{type:"fillSketch",ops:this.renderLines(s,e,n)}}_fillEllipse(t,e,n,s,i,o=!1){const r=y(t,e,n,s,i,this.renderer);return{type:"fillSketch",ops:this.renderLines(r,i,o)}}renderLines(t,e,n){let s=[],i=null;for(const o of t)s=s.concat(this.renderer.doubleLine(o[0][0],o[0][1],o[1][0],o[1][1],e)),n&&i&&(s=s.concat(this.renderer.doubleLine(i[0],i[1],o[0][0],o[0][1],e))),i=o[1];return s}}class g extends w{fillPolygon(t,e){return this._fillPolygon(t,e,!0)}fillEllipse(t,e,n,s,i){return this._fillEllipse(t,e,n,s,i,!0)}}class x extends w{fillPolygon(t,e){const n=this._fillPolygon(t,e),s=Object.assign({},e,{hachureAngle:e.hachureAngle+90}),i=this._fillPolygon(t,s);return n.ops=n.ops.concat(i.ops),n}fillEllipse(t,e,n,s,i){const o=this._fillEllipse(t,e,n,s,i),r=Object.assign({},i,{hachureAngle:i.hachureAngle+90}),a=this._fillEllipse(t,e,n,s,r);return o.ops=o.ops.concat(a.ops),o}}class m{constructor(t){this.renderer=t}fillPolygon(t,e){const n=p(t,e=Object.assign({},e,{curveStepCount:4,hachureAngle:0}));return this.dotsOnLines(n,e)}fillEllipse(t,e,n,s,i){const o=y(t,e,n,s,i=Object.assign({},i,{curveStepCount:4,hachureAngle:0}),this.renderer);return this.dotsOnLines(o,i)}dotsOnLines(t,e){let n=[],s=e.hachureGap;s<0&&(s=4*e.strokeWidth),s=Math.max(s,.1);let i=e.fillWeight;i<0&&(i=e.strokeWidth/2);for(const o of t){const t=f(o)/s,r=Math.ceil(t)-1,a=Math.atan((o[1][1]-o[0][1])/(o[1][0]-o[0][0]));for(let t=0;t<r;t++){const r=s*(t+1),h=r*Math.sin(a),l=r*Math.cos(a),c=[o[0][0]-l,o[0][1]+h],f=this.renderer.getOffset(c[0]-s/4,c[0]+s/4,e),d=this.renderer.getOffset(c[1]-s/4,c[1]+s/4,e),u=this.renderer.ellipse(f,d,i,i,e);n=n.concat(u.ops)}}return{type:"fillSketch",ops:n}}}const v={};function b(t,e){let n=e.fillStyle||"hachure";if(!v[n])switch(n){case"zigzag":v[n]||(v[n]=new g(t));break;case"cross-hatch":v[n]||(v[n]=new x(t));break;case"dots":v[n]||(v[n]=new m(t));break;case"hachure":default:v[n="hachure"]||(v[n]=new w(t))}return v[n]}class I{line(t,e,n,s,i){return{type:"path",ops:this.doubleLine(t,e,n,s,i)}}linearPath(t,e,n){const s=(t||[]).length;if(s>2){let i=[];for(let e=0;e<s-1;e++)i=i.concat(this.doubleLine(t[e][0],t[e][1],t[e+1][0],t[e+1][1],n));return e&&(i=i.concat(this.doubleLine(t[s-1][0],t[s-1][1],t[0][0],t[0][1],n))),{type:"path",ops:i}}return 2===s?this.line(t[0][0],t[0][1],t[1][0],t[1][1],n):{type:"path",ops:[]}}polygon(t,e){return this.linearPath(t,!0,e)}rectangle(t,e,n,s,i){const o=[[t,e],[t+n,e],[t+n,e+s],[t,e+s]];return this.polygon(o,i)}curve(t,e){const n=this._curveWithOffset(t,1*(1+.2*e.roughness),e),s=this._curveWithOffset(t,1.5*(1+.22*e.roughness),e);return{type:"path",ops:n.concat(s)}}ellipse(t,e,n,s,i){const o=2*Math.PI/i.curveStepCount;let r=Math.abs(n/2),a=Math.abs(s/2);r+=this.getOffset(.05*-r,.05*r,i),a+=this.getOffset(.05*-a,.05*a,i);const h=this._ellipse(o,t,e,r,a,1,o*this.getOffset(.1,this.getOffset(.4,1,i),i),i),l=this._ellipse(o,t,e,r,a,1.5,0,i);return{type:"path",ops:h.concat(l)}}arc(t,e,n,s,i,o,r,a,h){const l=t,c=e;let f=Math.abs(n/2),d=Math.abs(s/2);f+=this.getOffset(.01*-f,.01*f,h),d+=this.getOffset(.01*-d,.01*d,h);let u=i,p=o;for(;u<0;)u+=2*Math.PI,p+=2*Math.PI;p-u>2*Math.PI&&(u=0,p=2*Math.PI);const y=2*Math.PI/h.curveStepCount,w=Math.min(y/2,(p-u)/2),g=this._arc(w,l,c,f,d,u,p,1,h),x=this._arc(w,l,c,f,d,u,p,1.5,h);let m=g.concat(x);return r&&(a?m=(m=m.concat(this.doubleLine(l,c,l+f*Math.cos(u),c+d*Math.sin(u),h))).concat(this.doubleLine(l,c,l+f*Math.cos(p),c+d*Math.sin(p),h)):(m.push({op:"lineTo",data:[l,c]}),m.push({op:"lineTo",data:[l+f*Math.cos(u),c+d*Math.sin(u)]}))),{type:"path",ops:m}}svgPath(t,e){t=(t||"").replace(/\n/g," ").replace(/(-\s)/g,"-").replace("/(ss)/g"," ");let n=new r(t);if(e.simplification){const t=new h(n.linearPoints,n.closed).fit(e.simplification);n=new r(t)}let s=[];const i=n.segments||[];for(let t=0;t<i.length;t++){const o=i[t],r=t>0?i[t-1]:null,a=this._processSegment(n,o,r,e);a&&a.length&&(s=s.concat(a))}return{type:"path",ops:s}}solidFillPolygon(t,e){const n=[];if(t.length){const s=e.maxRandomnessOffset||0,i=t.length;if(i>2){n.push({op:"move",data:[t[0][0]+this.getOffset(-s,s,e),t[0][1]+this.getOffset(-s,s,e)]});for(let o=1;o<i;o++)n.push({op:"lineTo",data:[t[o][0]+this.getOffset(-s,s,e),t[o][1]+this.getOffset(-s,s,e)]})}}return{type:"fillPath",ops:n}}patternFillPolygon(t,e){return b(this,e).fillPolygon(t,e)}patternFillEllipse(t,e,n,s,i){return b(this,i).fillEllipse(t,e,n,s,i)}patternFillArc(t,e,n,s,i,o,r){const a=t,h=e;let l=Math.abs(n/2),c=Math.abs(s/2);l+=this.getOffset(.01*-l,.01*l,r),c+=this.getOffset(.01*-c,.01*c,r);let f=i,d=o;for(;f<0;)f+=2*Math.PI,d+=2*Math.PI;d-f>2*Math.PI&&(f=0,d=2*Math.PI);const u=(d-f)/r.curveStepCount,p=[];for(let t=f;t<=d;t+=u)p.push([a+l*Math.cos(t),h+c*Math.sin(t)]);return p.push([a+l*Math.cos(d),h+c*Math.sin(d)]),p.push([a,h]),this.patternFillPolygon(p,r)}getOffset(t,e,n){return n.roughness*(Math.random()*(e-t)+t)}doubleLine(t,e,n,s,i){const o=this._line(t,e,n,s,i,!0,!1),r=this._line(t,e,n,s,i,!0,!0);return o.concat(r)}_line(t,e,n,s,i,o,r){const a=Math.pow(t-n,2)+Math.pow(e-s,2);let h=i.maxRandomnessOffset||0;h*h*100>a&&(h=Math.sqrt(a)/10);const l=h/2,c=.2+.2*Math.random();let f=i.bowing*i.maxRandomnessOffset*(s-e)/200,d=i.bowing*i.maxRandomnessOffset*(t-n)/200;f=this.getOffset(-f,f,i),d=this.getOffset(-d,d,i);const u=[];return o&&(r?u.push({op:"move",data:[t+this.getOffset(-l,l,i),e+this.getOffset(-l,l,i)]}):u.push({op:"move",data:[t+this.getOffset(-h,h,i),e+this.getOffset(-h,h,i)]})),r?u.push({op:"bcurveTo",data:[f+t+(n-t)*c+this.getOffset(-l,l,i),d+e+(s-e)*c+this.getOffset(-l,l,i),f+t+2*(n-t)*c+this.getOffset(-l,l,i),d+e+2*(s-e)*c+this.getOffset(-l,l,i),n+this.getOffset(-l,l,i),s+this.getOffset(-l,l,i)]}):u.push({op:"bcurveTo",data:[f+t+(n-t)*c+this.getOffset(-h,h,i),d+e+(s-e)*c+this.getOffset(-h,h,i),f+t+2*(n-t)*c+this.getOffset(-h,h,i),d+e+2*(s-e)*c+this.getOffset(-h,h,i),n+this.getOffset(-h,h,i),s+this.getOffset(-h,h,i)]}),u}_curve(t,e,n){const s=t.length;let i=[];if(s>3){const o=[],r=1-n.curveTightness;i.push({op:"move",data:[t[1][0],t[1][1]]});for(let e=1;e+2<s;e++){const n=t[e];o[0]=[n[0],n[1]],o[1]=[n[0]+(r*t[e+1][0]-r*t[e-1][0])/6,n[1]+(r*t[e+1][1]-r*t[e-1][1])/6],o[2]=[t[e+1][0]+(r*t[e][0]-r*t[e+2][0])/6,t[e+1][1]+(r*t[e][1]-r*t[e+2][1])/6],o[3]=[t[e+1][0],t[e+1][1]],i.push({op:"bcurveTo",data:[o[1][0],o[1][1],o[2][0],o[2][1],o[3][0],o[3][1]]})}if(e&&2===e.length){const t=n.maxRandomnessOffset;i.push({op:"lineTo",data:[e[0]+this.getOffset(-t,t,n),e[1]+ +this.getOffset(-t,t,n)]})}}else 3===s?(i.push({op:"move",data:[t[1][0],t[1][1]]}),i.push({op:"bcurveTo",data:[t[1][0],t[1][1],t[2][0],t[2][1],t[2][0],t[2][1]]})):2===s&&(i=i.concat(this.doubleLine(t[0][0],t[0][1],t[1][0],t[1][1],n)));return i}_ellipse(t,e,n,s,i,o,r,a){const h=this.getOffset(-.5,.5,a)-Math.PI/2,l=[];l.push([this.getOffset(-o,o,a)+e+.9*s*Math.cos(h-t),this.getOffset(-o,o,a)+n+.9*i*Math.sin(h-t)]);for(let r=h;r<2*Math.PI+h-.01;r+=t)l.push([this.getOffset(-o,o,a)+e+s*Math.cos(r),this.getOffset(-o,o,a)+n+i*Math.sin(r)]);return l.push([this.getOffset(-o,o,a)+e+s*Math.cos(h+2*Math.PI+.5*r),this.getOffset(-o,o,a)+n+i*Math.sin(h+2*Math.PI+.5*r)]),l.push([this.getOffset(-o,o,a)+e+.98*s*Math.cos(h+r),this.getOffset(-o,o,a)+n+.98*i*Math.sin(h+r)]),l.push([this.getOffset(-o,o,a)+e+.9*s*Math.cos(h+.5*r),this.getOffset(-o,o,a)+n+.9*i*Math.sin(h+.5*r)]),this._curve(l,null,a)}_curveWithOffset(t,e,n){const s=[];s.push([t[0][0]+this.getOffset(-e,e,n),t[0][1]+this.getOffset(-e,e,n)]),s.push([t[0][0]+this.getOffset(-e,e,n),t[0][1]+this.getOffset(-e,e,n)]);for(let i=1;i<t.length;i++)s.push([t[i][0]+this.getOffset(-e,e,n),t[i][1]+this.getOffset(-e,e,n)]),i===t.length-1&&s.push([t[i][0]+this.getOffset(-e,e,n),t[i][1]+this.getOffset(-e,e,n)]);return this._curve(s,null,n)}_arc(t,e,n,s,i,o,r,a,h){const l=o+this.getOffset(-.1,.1,h),c=[];c.push([this.getOffset(-a,a,h)+e+.9*s*Math.cos(l-t),this.getOffset(-a,a,h)+n+.9*i*Math.sin(l-t)]);for(let o=l;o<=r;o+=t)c.push([this.getOffset(-a,a,h)+e+s*Math.cos(o),this.getOffset(-a,a,h)+n+i*Math.sin(o)]);return c.push([e+s*Math.cos(r),n+i*Math.sin(r)]),c.push([e+s*Math.cos(r),n+i*Math.sin(r)]),this._curve(c,null,h)}_bezierTo(t,e,n,s,i,o,r,a){const h=[],l=[a.maxRandomnessOffset||1,(a.maxRandomnessOffset||1)+.5];let c=[0,0];for(let f=0;f<2;f++)0===f?h.push({op:"move",data:[r.x,r.y]}):h.push({op:"move",data:[r.x+this.getOffset(-l[0],l[0],a),r.y+this.getOffset(-l[0],l[0],a)]}),c=[i+this.getOffset(-l[f],l[f],a),o+this.getOffset(-l[f],l[f],a)],h.push({op:"bcurveTo",data:[t+this.getOffset(-l[f],l[f],a),e+this.getOffset(-l[f],l[f],a),n+this.getOffset(-l[f],l[f],a),s+this.getOffset(-l[f],l[f],a),c[0],c[1]]});return r.setPosition(c[0],c[1]),h}_processSegment(t,e,n,s){let i=[];switch(e.key){case"M":case"m":{const n="m"===e.key;if(e.data.length>=2){let o=+e.data[0],r=+e.data[1];n&&(o+=t.x,r+=t.y);const a=1*(s.maxRandomnessOffset||0);o+=this.getOffset(-a,a,s),r+=this.getOffset(-a,a,s),t.setPosition(o,r),i.push({op:"move",data:[o,r]})}break}case"L":case"l":{const n="l"===e.key;if(e.data.length>=2){let o=+e.data[0],r=+e.data[1];n&&(o+=t.x,r+=t.y),i=i.concat(this.doubleLine(t.x,t.y,o,r,s)),t.setPosition(o,r)}break}case"H":case"h":{const n="h"===e.key;if(e.data.length){let o=+e.data[0];n&&(o+=t.x),i=i.concat(this.doubleLine(t.x,t.y,o,t.y,s)),t.setPosition(o,t.y)}break}case"V":case"v":{const n="v"===e.key;if(e.data.length){let o=+e.data[0];n&&(o+=t.y),i=i.concat(this.doubleLine(t.x,t.y,t.x,o,s)),t.setPosition(t.x,o)}break}case"Z":case"z":t.first&&(i=i.concat(this.doubleLine(t.x,t.y,t.first[0],t.first[1],s)),t.setPosition(t.first[0],t.first[1]),t.first=null);break;case"C":case"c":{const n="c"===e.key;if(e.data.length>=6){let o=+e.data[0],r=+e.data[1],a=+e.data[2],h=+e.data[3],l=+e.data[4],c=+e.data[5];n&&(o+=t.x,a+=t.x,l+=t.x,r+=t.y,h+=t.y,c+=t.y);const f=this._bezierTo(o,r,a,h,l,c,t,s);i=i.concat(f),t.bezierReflectionPoint=[l+(l-a),c+(c-h)]}break}case"S":case"s":{const o="s"===e.key;if(e.data.length>=4){let r=+e.data[0],a=+e.data[1],h=+e.data[2],l=+e.data[3];o&&(r+=t.x,h+=t.x,a+=t.y,l+=t.y);let c=r,f=a;const d=n?n.key:"";let u=null;"c"!==d&&"C"!==d&&"s"!==d&&"S"!==d||(u=t.bezierReflectionPoint),u&&(c=u[0],f=u[1]);const p=this._bezierTo(c,f,r,a,h,l,t,s);i=i.concat(p),t.bezierReflectionPoint=[h+(h-r),l+(l-a)]}break}case"Q":case"q":{const n="q"===e.key;if(e.data.length>=4){let o=+e.data[0],r=+e.data[1],a=+e.data[2],h=+e.data[3];n&&(o+=t.x,a+=t.x,r+=t.y,h+=t.y);const l=1*(1+.2*s.roughness),c=1.5*(1+.22*s.roughness);i.push({op:"move",data:[t.x+this.getOffset(-l,l,s),t.y+this.getOffset(-l,l,s)]});let f=[a+this.getOffset(-l,l,s),h+this.getOffset(-l,l,s)];i.push({op:"qcurveTo",data:[o+this.getOffset(-l,l,s),r+this.getOffset(-l,l,s),f[0],f[1]]}),i.push({op:"move",data:[t.x+this.getOffset(-c,c,s),t.y+this.getOffset(-c,c,s)]}),f=[a+this.getOffset(-c,c,s),h+this.getOffset(-c,c,s)],i.push({op:"qcurveTo",data:[o+this.getOffset(-c,c,s),r+this.getOffset(-c,c,s),f[0],f[1]]}),t.setPosition(f[0],f[1]),t.quadReflectionPoint=[a+(a-o),h+(h-r)]}break}case"T":case"t":{const o="t"===e.key;if(e.data.length>=2){let r=+e.data[0],a=+e.data[1];o&&(r+=t.x,a+=t.y);let h=r,l=a;const c=n?n.key:"";let f=null;"q"!==c&&"Q"!==c&&"t"!==c&&"T"!==c||(f=t.quadReflectionPoint),f&&(h=f[0],l=f[1]);const d=1*(1+.2*s.roughness),u=1.5*(1+.22*s.roughness);i.push({op:"move",data:[t.x+this.getOffset(-d,d,s),t.y+this.getOffset(-d,d,s)]});let p=[r+this.getOffset(-d,d,s),a+this.getOffset(-d,d,s)];i.push({op:"qcurveTo",data:[h+this.getOffset(-d,d,s),l+this.getOffset(-d,d,s),p[0],p[1]]}),i.push({op:"move",data:[t.x+this.getOffset(-u,u,s),t.y+this.getOffset(-u,u,s)]}),p=[r+this.getOffset(-u,u,s),a+this.getOffset(-u,u,s)],i.push({op:"qcurveTo",data:[h+this.getOffset(-u,u,s),l+this.getOffset(-u,u,s),p[0],p[1]]}),t.setPosition(p[0],p[1]),t.quadReflectionPoint=[r+(r-h),a+(a-l)]}break}case"A":case"a":{const n="a"===e.key;if(e.data.length>=7){const o=+e.data[0],r=+e.data[1],h=+e.data[2],l=+e.data[3],c=+e.data[4];let f=+e.data[5],d=+e.data[6];if(n&&(f+=t.x,d+=t.y),f===t.x&&d===t.y)break;if(0===o||0===r)i=i.concat(this.doubleLine(t.x,t.y,f,d,s)),t.setPosition(f,d);else for(let e=0;e<1;e++){const e=new a([t.x,t.y],[f,d],[o,r],h,!!l,!!c);let n=e.getNextSegment();for(;n;){const o=this._bezierTo(n.cp1[0],n.cp1[1],n.cp2[0],n.cp2[1],n.to[0],n.to[1],t,s);i=i.concat(o),n=e.getNextSegment()}}}break}}return i}}const _="undefined"!=typeof self,k=_&&self&&self.document&&self.document.currentScript&&self.document.currentScript.src;const M="undefined"!=typeof self;class O{constructor(t,e){this.defaultOptions={maxRandomnessOffset:2,roughness:1,bowing:1,stroke:"#000",strokeWidth:1,curveTightness:0,curveStepCount:9,fillStyle:"hachure",fillWeight:-1,hachureAngle:-41,hachureGap:-1},this.config=t||{},this.surface=e,this.renderer=function(t){if(_&&k&&self&&self.workly&&t.async&&!t.noWorker){const e=t.worklyURL||"https://cdn.jsdelivr.net/gh/pshihn/workly/dist/workly.min.js";if(e){const t=`importScripts('${e}', '${k}');\nworkly.expose(self.rough.createRenderer());`,n=URL.createObjectURL(new Blob([t]));return self.workly.proxy(n)}}return new I}(this.config),this.config.options&&(this.defaultOptions=this._options(this.config.options))}_options(t){return t?Object.assign({},this.defaultOptions,t):this.defaultOptions}_drawable(t,e,n){return{shape:t,sets:e||[],options:n||this.defaultOptions}}get lib(){return this.renderer}getCanvasSize(){const t=t=>t&&"object"==typeof t&&t.baseVal&&t.baseVal.value?t.baseVal.value:t||100;return this.surface?[t(this.surface.width),t(this.surface.height)]:[100,100]}computePolygonSize(t){if(t.length){let e=t[0][0],n=t[0][0],s=t[0][1],i=t[0][1];for(let o=1;o<t.length;o++)e=Math.min(e,t[o][0]),n=Math.max(n,t[o][0]),s=Math.min(s,t[o][1]),i=Math.max(i,t[o][1]);return[n-e,i-s]}return[0,0]}polygonPath(t){let e="";if(t.length){e=`M${t[0][0]},${t[0][1]}`;for(let n=1;n<t.length;n++)e=`${e} L${t[n][0]},${t[n][1]}`}return e}computePathSize(t){let e=[0,0];if(M&&self.document)try{const n="http://www.w3.org/2000/svg",s=self.document.createElementNS(n,"svg");s.setAttribute("width","0"),s.setAttribute("height","0");const i=self.document.createElementNS(n,"path");i.setAttribute("d",t),s.appendChild(i),self.document.body.appendChild(s);const o=i.getBBox();o&&(e[0]=o.width||0,e[1]=o.height||0),self.document.body.removeChild(s)}catch(t){}const n=this.getCanvasSize();return e[0]*e[1]||(e=n),e}toPaths(t){const e=t.sets||[],n=t.options||this.defaultOptions,s=[];for(const t of e){let e=null;switch(t.type){case"path":e={d:this.opsToPath(t),stroke:n.stroke,strokeWidth:n.strokeWidth,fill:"none"};break;case"fillPath":e={d:this.opsToPath(t),stroke:"none",strokeWidth:0,fill:n.fill||"none"};break;case"fillSketch":e=this.fillSketch(t,n);break;case"path2Dfill":e={d:t.path||"",stroke:"none",strokeWidth:0,fill:n.fill||"none"};break;case"path2Dpattern":{const s=t.size,i={x:0,y:0,width:1,height:1,viewBox:`0 0 ${Math.round(s[0])} ${Math.round(s[1])}`,patternUnits:"objectBoundingBox",path:this.fillSketch(t,n)};e={d:t.path,stroke:"none",strokeWidth:0,pattern:i};break}}e&&s.push(e)}return s}fillSketch(t,e){let n=e.fillWeight;return n<0&&(n=e.strokeWidth/2),{d:this.opsToPath(t),stroke:e.fill||"none",strokeWidth:n,fill:"none"}}opsToPath(t){let e="";for(const n of t.ops){const t=n.data;switch(n.op){case"move":e+=`M${t[0]} ${t[1]} `;break;case"bcurveTo":e+=`C${t[0]} ${t[1]}, ${t[2]} ${t[3]}, ${t[4]} ${t[5]} `;break;case"qcurveTo":e+=`Q${t[0]} ${t[1]}, ${t[2]} ${t[3]} `;break;case"lineTo":e+=`L${t[0]} ${t[1]} `}}return e.trim()}}class P extends O{constructor(t,e){super(t,e)}line(t,e,n,s,i){const o=this._options(i);return this._drawable("line",[this.lib.line(t,e,n,s,o)],o)}rectangle(t,e,n,s,i){const o=this._options(i),r=[];if(o.fill){const i=[[t,e],[t+n,e],[t+n,e+s],[t,e+s]];"solid"===o.fillStyle?r.push(this.lib.solidFillPolygon(i,o)):r.push(this.lib.patternFillPolygon(i,o))}return r.push(this.lib.rectangle(t,e,n,s,o)),this._drawable("rectangle",r,o)}ellipse(t,e,n,s,i){const o=this._options(i),r=[];if(o.fill)if("solid"===o.fillStyle){const i=this.lib.ellipse(t,e,n,s,o);i.type="fillPath",r.push(i)}else r.push(this.lib.patternFillEllipse(t,e,n,s,o));return r.push(this.lib.ellipse(t,e,n,s,o)),this._drawable("ellipse",r,o)}circle(t,e,n,s){const i=this.ellipse(t,e,n,n,s);return i.shape="circle",i}linearPath(t,e){const n=this._options(e);return this._drawable("linearPath",[this.lib.linearPath(t,!1,n)],n)}arc(t,e,n,s,i,o,r=!1,a){const h=this._options(a),l=[];if(r&&h.fill)if("solid"===h.fillStyle){const r=this.lib.arc(t,e,n,s,i,o,!0,!1,h);r.type="fillPath",l.push(r)}else l.push(this.lib.patternFillArc(t,e,n,s,i,o,h));return l.push(this.lib.arc(t,e,n,s,i,o,r,!0,h)),this._drawable("arc",l,h)}curve(t,e){const n=this._options(e);return this._drawable("curve",[this.lib.curve(t,n)],n)}polygon(t,e){const n=this._options(e),s=[];if(n.fill)if("solid"===n.fillStyle)s.push(this.lib.solidFillPolygon(t,n));else{const e=this.computePolygonSize(t),i=[[0,0],[e[0],0],[e[0],e[1]],[0,e[1]]],o=this.lib.patternFillPolygon(i,n);o.type="path2Dpattern",o.size=e,o.path=this.polygonPath(t),s.push(o)}return s.push(this.lib.linearPath(t,!0,n)),this._drawable("polygon",s,n)}path(t,e){const n=this._options(e),s=[];if(!t)return this._drawable("path",s,n);if(n.fill)if("solid"===n.fillStyle){const e={type:"path2Dfill",path:t,ops:[]};s.push(e)}else{const e=this.computePathSize(t),i=[[0,0],[e[0],0],[e[0],e[1]],[0,e[1]]],o=this.lib.patternFillPolygon(i,n);o.type="path2Dpattern",o.size=e,o.path=t,s.push(o)}return s.push(this.lib.svgPath(t,n)),this._drawable("path",s,n)}}const A="undefined"!=typeof document;class D{constructor(t){this.canvas=t,this.ctx=this.canvas.getContext("2d")}static createRenderer(){return new I}draw(t){const e=t.sets||[],n=t.options||this.getDefaultOptions(),s=this.ctx;for(const t of e)switch(t.type){case"path":s.save(),s.strokeStyle=n.stroke,s.lineWidth=n.strokeWidth,this._drawToContext(s,t),s.restore();break;case"fillPath":s.save(),s.fillStyle=n.fill||"",this._drawToContext(s,t),s.restore();break;case"fillSketch":this.fillSketch(s,t,n);break;case"path2Dfill":{this.ctx.save(),this.ctx.fillStyle=n.fill||"";const e=new Path2D(t.path);this.ctx.fill(e),this.ctx.restore();break}case"path2Dpattern":{const e=this.canvas.ownerDocument||A&&document;if(e){const s=t.size,i=e.createElement("canvas"),o=i.getContext("2d"),r=this.computeBBox(t.path);r&&(r.width||r.height)?(i.width=this.canvas.width,i.height=this.canvas.height,o.translate(r.x||0,r.y||0)):(i.width=s[0],i.height=s[1]),this.fillSketch(o,t,n),this.ctx.save(),this.ctx.fillStyle=this.ctx.createPattern(i,"repeat");const a=new Path2D(t.path);this.ctx.fill(a),this.ctx.restore()}else console.error("Cannot render path2Dpattern. No defs/document defined.");break}}}computeBBox(t){if(A)try{const e="http://www.w3.org/2000/svg",n=document.createElementNS(e,"svg");n.setAttribute("width","0"),n.setAttribute("height","0");const s=self.document.createElementNS(e,"path");s.setAttribute("d",t),n.appendChild(s),document.body.appendChild(n);const i=s.getBBox();return document.body.removeChild(n),i}catch(t){}return null}fillSketch(t,e,n){let s=n.fillWeight;s<0&&(s=n.strokeWidth/2),t.save(),t.strokeStyle=n.fill||"",t.lineWidth=s,this._drawToContext(t,e),t.restore()}_drawToContext(t,e){t.beginPath();for(const n of e.ops){const e=n.data;switch(n.op){case"move":t.moveTo(e[0],e[1]);break;case"bcurveTo":t.bezierCurveTo(e[0],e[1],e[2],e[3],e[4],e[5]);break;case"qcurveTo":t.quadraticCurveTo(e[0],e[1],e[2],e[3]);break;case"lineTo":t.lineTo(e[0],e[1])}}"fillPath"===e.type?t.fill():t.stroke()}}class E extends D{constructor(t,e){super(t),this.gen=new P(e||null,this.canvas)}get generator(){return this.gen}getDefaultOptions(){return this.gen.defaultOptions}line(t,e,n,s,i){const o=this.gen.line(t,e,n,s,i);return this.draw(o),o}rectangle(t,e,n,s,i){const o=this.gen.rectangle(t,e,n,s,i);return this.draw(o),o}ellipse(t,e,n,s,i){const o=this.gen.ellipse(t,e,n,s,i);return this.draw(o),o}circle(t,e,n,s){const i=this.gen.circle(t,e,n,s);return this.draw(i),i}linearPath(t,e){const n=this.gen.linearPath(t,e);return this.draw(n),n}polygon(t,e){const n=this.gen.polygon(t,e);return this.draw(n),n}arc(t,e,n,s,i,o,r=!1,a){const h=this.gen.arc(t,e,n,s,i,o,r,a);return this.draw(h),h}curve(t,e){const n=this.gen.curve(t,e);return this.draw(n),n}path(t,e){const n=this.gen.path(t,e);return this.draw(n),n}}class S extends O{async line(t,e,n,s,i){const o=this._options(i);return this._drawable("line",[await this.lib.line(t,e,n,s,o)],o)}async rectangle(t,e,n,s,i){const o=this._options(i),r=[];if(o.fill){const i=[[t,e],[t+n,e],[t+n,e+s],[t,e+s]];"solid"===o.fillStyle?r.push(await this.lib.solidFillPolygon(i,o)):r.push(await this.lib.patternFillPolygon(i,o))}return r.push(await this.lib.rectangle(t,e,n,s,o)),this._drawable("rectangle",r,o)}async ellipse(t,e,n,s,i){const o=this._options(i),r=[];if(o.fill)if("solid"===o.fillStyle){const i=await this.lib.ellipse(t,e,n,s,o);i.type="fillPath",r.push(i)}else r.push(await this.lib.patternFillEllipse(t,e,n,s,o));return r.push(await this.lib.ellipse(t,e,n,s,o)),this._drawable("ellipse",r,o)}async circle(t,e,n,s){const i=await this.ellipse(t,e,n,n,s);return i.shape="circle",i}async linearPath(t,e){const n=this._options(e);return this._drawable("linearPath",[await this.lib.linearPath(t,!1,n)],n)}async arc(t,e,n,s,i,o,r=!1,a){const h=this._options(a),l=[];if(r&&h.fill)if("solid"===h.fillStyle){const r=await this.lib.arc(t,e,n,s,i,o,!0,!1,h);r.type="fillPath",l.push(r)}else l.push(await this.lib.patternFillArc(t,e,n,s,i,o,h));return l.push(await this.lib.arc(t,e,n,s,i,o,r,!0,h)),this._drawable("arc",l,h)}async curve(t,e){const n=this._options(e);return this._drawable("curve",[await this.lib.curve(t,n)],n)}async polygon(t,e){const n=this._options(e),s=[];if(n.fill)if("solid"===n.fillStyle)s.push(await this.lib.solidFillPolygon(t,n));else{const e=this.computePolygonSize(t),i=[[0,0],[e[0],0],[e[0],e[1]],[0,e[1]]],o=await this.lib.patternFillPolygon(i,n);o.type="path2Dpattern",o.size=e,o.path=this.polygonPath(t),s.push(o)}return s.push(await this.lib.linearPath(t,!0,n)),this._drawable("polygon",s,n)}async path(t,e){const n=this._options(e),s=[];if(!t)return this._drawable("path",s,n);if(n.fill)if("solid"===n.fillStyle){const e={type:"path2Dfill",path:t,ops:[]};s.push(e)}else{const e=this.computePathSize(t),i=[[0,0],[e[0],0],[e[0],e[1]],[0,e[1]]],o=await this.lib.patternFillPolygon(i,n);o.type="path2Dpattern",o.size=e,o.path=t,s.push(o)}return s.push(await this.lib.svgPath(t,n)),this._drawable("path",s,n)}}class C extends D{constructor(t,e){super(t),this.genAsync=new S(e||null,this.canvas)}get generator(){return this.genAsync}getDefaultOptions(){return this.genAsync.defaultOptions}async line(t,e,n,s,i){const o=await this.genAsync.line(t,e,n,s,i);return this.draw(o),o}async rectangle(t,e,n,s,i){const o=await this.genAsync.rectangle(t,e,n,s,i);return this.draw(o),o}async ellipse(t,e,n,s,i){const o=await this.genAsync.ellipse(t,e,n,s,i);return this.draw(o),o}async circle(t,e,n,s){const i=await this.genAsync.circle(t,e,n,s);return this.draw(i),i}async linearPath(t,e){const n=await this.genAsync.linearPath(t,e);return this.draw(n),n}async polygon(t,e){const n=await this.genAsync.polygon(t,e);return this.draw(n),n}async arc(t,e,n,s,i,o,r=!1,a){const h=await this.genAsync.arc(t,e,n,s,i,o,r,a);return this.draw(h),h}async curve(t,e){const n=await this.genAsync.curve(t,e);return this.draw(n),n}async path(t,e){const n=await this.genAsync.path(t,e);return this.draw(n),n}}const B="undefined"!=typeof document;class T{constructor(t){this.svg=t}static createRenderer(){return new I}get defs(){const t=this.svg.ownerDocument||B&&document;if(t&&!this._defs){const e=t.createElementNS("http://www.w3.org/2000/svg","defs");this.svg.firstChild?this.svg.insertBefore(e,this.svg.firstChild):this.svg.appendChild(e),this._defs=e}return this._defs||null}draw(t){const e=t.sets||[],n=t.options||this.getDefaultOptions(),s=this.svg.ownerDocument||B&&document,i=s.createElementNS("http://www.w3.org/2000/svg","g");for(const t of e){let e=null;switch(t.type){case"path":(e=s.createElementNS("http://www.w3.org/2000/svg","path")).setAttribute("d",this.opsToPath(t)),e.style.stroke=n.stroke,e.style.strokeWidth=n.strokeWidth+"",e.style.fill="none";break;case"fillPath":(e=s.createElementNS("http://www.w3.org/2000/svg","path")).setAttribute("d",this.opsToPath(t)),e.style.stroke="none",e.style.strokeWidth="0",e.style.fill=n.fill||null;break;case"fillSketch":e=this.fillSketch(s,t,n);break;case"path2Dfill":(e=s.createElementNS("http://www.w3.org/2000/svg","path")).setAttribute("d",t.path||""),e.style.stroke="none",e.style.strokeWidth="0",e.style.fill=n.fill||null;break;case"path2Dpattern":if(this.defs){const i=t.size,o=s.createElementNS("http://www.w3.org/2000/svg","pattern"),r=`rough-${Math.floor(Math.random()*(Number.MAX_SAFE_INTEGER||999999))}`;o.setAttribute("id",r),o.setAttribute("x","0"),o.setAttribute("y","0"),o.setAttribute("width","1"),o.setAttribute("height","1"),o.setAttribute("height","1"),o.setAttribute("viewBox",`0 0 ${Math.round(i[0])} ${Math.round(i[1])}`),o.setAttribute("patternUnits","objectBoundingBox");const a=this.fillSketch(s,t,n);o.appendChild(a),this.defs.appendChild(o),(e=s.createElementNS("http://www.w3.org/2000/svg","path")).setAttribute("d",t.path||""),e.style.stroke="none",e.style.strokeWidth="0",e.style.fill=`url(#${r})`}else console.error("Cannot render path2Dpattern. No defs/document defined.")}e&&i.appendChild(e)}return i}fillSketch(t,e,n){let s=n.fillWeight;s<0&&(s=n.strokeWidth/2);const i=t.createElementNS("http://www.w3.org/2000/svg","path");return i.setAttribute("d",this.opsToPath(e)),i.style.stroke=n.fill||null,i.style.strokeWidth=s+"",i.style.fill="none",i}}class N extends T{constructor(t,e){super(t),this.gen=new P(e||null,this.svg)}get generator(){return this.gen}getDefaultOptions(){return this.gen.defaultOptions}opsToPath(t){return this.gen.opsToPath(t)}line(t,e,n,s,i){const o=this.gen.line(t,e,n,s,i);return this.draw(o)}rectangle(t,e,n,s,i){const o=this.gen.rectangle(t,e,n,s,i);return this.draw(o)}ellipse(t,e,n,s,i){const o=this.gen.ellipse(t,e,n,s,i);return this.draw(o)}circle(t,e,n,s){const i=this.gen.circle(t,e,n,s);return this.draw(i)}linearPath(t,e){const n=this.gen.linearPath(t,e);return this.draw(n)}polygon(t,e){const n=this.gen.polygon(t,e);return this.draw(n)}arc(t,e,n,s,i,o,r=!1,a){const h=this.gen.arc(t,e,n,s,i,o,r,a);return this.draw(h)}curve(t,e){const n=this.gen.curve(t,e);return this.draw(n)}path(t,e){const n=this.gen.path(t,e);return this.draw(n)}}class L extends T{constructor(t,e){super(t),this.genAsync=new S(e||null,this.svg)}get generator(){return this.genAsync}getDefaultOptions(){return this.genAsync.defaultOptions}opsToPath(t){return this.genAsync.opsToPath(t)}async line(t,e,n,s,i){const o=await this.genAsync.line(t,e,n,s,i);return this.draw(o)}async rectangle(t,e,n,s,i){const o=await this.genAsync.rectangle(t,e,n,s,i);return this.draw(o)}async ellipse(t,e,n,s,i){const o=await this.genAsync.ellipse(t,e,n,s,i);return this.draw(o)}async circle(t,e,n,s){const i=await this.genAsync.circle(t,e,n,s);return this.draw(i)}async linearPath(t,e){const n=await this.genAsync.linearPath(t,e);return this.draw(n)}async polygon(t,e){const n=await this.genAsync.polygon(t,e);return this.draw(n)}async arc(t,e,n,s,i,o,r=!1,a){const h=await this.genAsync.arc(t,e,n,s,i,o,r,a);return this.draw(h)}async curve(t,e){const n=await this.genAsync.curve(t,e);return this.draw(n)}async path(t,e){const n=await this.genAsync.path(t,e);return this.draw(n)}}e.default={canvas:(t,e)=>e&&e.async?new C(t,e):new E(t,e),svg:(t,e)=>e&&e.async?new L(t,e):new N(t,e),createRenderer:()=>E.createRenderer(),generator:(t,e)=>t&&t.async?new S(t,e):new P(t,e)}}]);